<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All the Light We Cannot See - Interactive Experience</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #121212;
      --secondary: #f5f5f7;
      --accent: #0066cc;
      --subtle: #8e8e93;
      --success: #34c759;
      --warning: #ff9500;
      --danger: #ff3b30;
      --info: #5ac8fa;
      --timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: var(--primary);
      background-color: var(--secondary);
      overflow-x: hidden;
      transition: background-color 0.5s var(--timing-function);
    }
    body.dark { background-color: var(--primary); color: var(--secondary); }
    .container { width: 100%; padding: 0; position: relative; }
    .progress-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 4px;
      background: transparent; z-index: 2000;
    }
    .progress-bar {
      height: 100%; background: var(--accent); width: 0%;
      transition: width 0.1s ease;
    }
    .sticky-browser {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%); z-index: 100;
      width: 95%; max-width: 1080px; opacity: 1; transform-origin: center;
      transition: opacity 0.5s var(--timing-function), transform 0.5s var(--timing-function);
    }
    section {
      min-height: 100vh; padding: 15vh 0;
      display: flex; align-items: center; justify-content: center; position: relative;
    }
    .browser-frame {
      width: 100%; max-width: 1080px; background: #fff;
      border-radius: 16px; box-shadow: 0 22px 70px rgba(0,0,0,0.2);
      overflow: hidden; margin: 0 auto;
      transition: all 0.8s var(--timing-function);
    }
    .browser-header {
      display: flex; align-items: center; padding: 14px 18px;
      background: #f0f0f0; border-bottom: 1px solid #e0e0e0;
      border-radius: 16px 16px 0 0;
    }
    body.dark .browser-header {
      background: #2c2c2e; border-bottom: 1px solid #3a3a3c;
    }
    .browser-dots { display: flex; gap: 8px; }
    .browser-dot {
      width: 12px; height: 12px; border-radius: 50%;
      transition: transform 0.2s var(--timing-function);
    }
    .browser-dot:hover { transform: scale(1.2); }
    .browser-dot.red { background: #ff5f57; }
    .browser-dot.yellow { background: #febc2e; }
    .browser-dot.green { background: #28c840; }
    .browser-address {
      flex: 1; margin: 0 16px; padding: 8px 14px;
      background: #e0e0e0; border-radius: 8px; color: #333;
      font-size: 14px; text-align: center; font-family: 'Inter', sans-serif;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      transition: all 0.3s var(--timing-function);
    }
    .browser-address:hover { background: #d0d0d0; }
    body.dark .browser-address { background: #3a3a3c; color: #e0e0e0; }
    body.dark .browser-address:hover { background: #4a4a4c; }
    .browser-buttons { display: flex; gap: 12px; }
    .browser-button {
      color: #8e8e93; font-size: 16px;
      transition: color 0.3s var(--timing-function), transform 0.2s var(--timing-function);
      cursor: pointer;
    }
    .browser-button:hover { color: var(--accent); transform: scale(1.1); }
    .browser-content {
      padding: 40px; min-height: 60vh; position: relative;
      background: white; transition: background-color 0.5s var(--timing-function);
      overflow-y: auto; max-height: 70vh;
    }
    body.dark .browser-content { background: #1c1c1e; }
    .heading {
      font-family: 'Playfair Display', serif; font-weight: 700;
      font-size: 3.5rem; margin-bottom: 24px; line-height: 1.2;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.3s, transform 0.8s var(--timing-function) 0.3s;
    }
    .heading.active { opacity: 1; transform: translateY(0); }
    .subheading {
      font-family: 'Playfair Display', serif; font-weight: 500;
      font-size: 1.5rem; margin-bottom: 16px; color: var(--accent);
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.5s, transform 0.8s var(--timing-function) 0.5s;
    }
    .subheading.active { opacity: 1; transform: translateY(0); }
    .paragraph {
      font-size: 1.125rem; line-height: 1.6; margin-bottom: 24px;
      max-width: 800px; opacity: 0; transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.7s, transform 0.8s var(--timing-function) 0.7s;
    }
    .paragraph.active { opacity: 1; transform: translateY(0); }
    .quote {
      font-family: 'Playfair Display', serif; font-size: 1.5rem;
      font-style: italic; color: var(--accent); margin: 40px 0;
      padding-left: 24px; border-left: 4px solid var(--accent);
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.9s, transform 0.8s var(--timing-function) 0.9s;
    }
    .quote.active { opacity: 1; transform: translateY(0); }
    .tabs {
      display: flex; border-bottom: 1px solid #e0e0e0; margin: 32px 0;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.7s, transform 0.8s var(--timing-function) 0.7s;
    }
    body.dark .tabs { border-bottom: 1px solid #3a3a3c; }
    .tabs.active { opacity: 1; transform: translateY(0); }
    .tab {
      padding: 12px 24px; font-weight: 500; cursor: pointer;
      position: relative; color: var(--subtle);
      transition: color 0.3s var(--timing-function);
    }
    .tab:hover { color: var(--accent); }
    .tab.active { color: var(--accent); }
    .tab.active::after {
      content: ''; position: absolute; bottom: -1px; left: 0;
      width: 100%; height: 2px; background: var(--accent);
      transform: scaleX(0); animation: tab-indicator 0.3s forwards var(--timing-function);
      transform-origin: left;
    }
    @keyframes tab-indicator { from { transform: scaleX(0); } to { transform: scaleX(1); } }
    .tab-content {
      padding: 32px 0; display: none; animation: fade-in 0.5s var(--timing-function);
    }
    .tab-content.active { display: block; }
    .blindness-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0); pointer-events: none; z-index: 900;
      transition: background 0.3s ease-out;
    }
    .model-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 24px; margin-top: 32px;
    }
    .model-item {
      height: 150px; background: #f0f0f0; border-radius: 12px;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      transition: transform 0.3s var(--timing-function), box-shadow 0.3s var(--timing-function);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; overflow: hidden;
    }
    body.dark .model-item { background: #2c2c2e; }
    .model-item:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
    .model-item img {
      max-width: 100%; max-height: 100%; object-fit: cover;
      transition: transform 0.3s var(--timing-function);
    }
    .model-item:hover img { transform: scale(1.05); }
    .model-title {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: rgba(0, 0, 0, 0.7); color: white; padding: 8px;
      font-size: 0.875rem; text-align: center;
      transform: translateY(100%); transition: transform 0.3s var(--timing-function);
    }
    .model-item:hover .model-title { transform: translateY(0); }
    .model-game {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.95); z-index: 1000;
      display: none; flex-direction: column; align-items: center; justify-content: center;
      padding: 24px; opacity: 0; transition: opacity 0.5s var(--timing-function);
    }
    .model-game.active { display: flex; opacity: 1; }
    .game-instructions {
      color: white; font-size: 1.25rem; text-align: center;
      margin-bottom: 32px; max-width: 600px;
    }
    .game-grid {
      display: grid; grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px); gap: 16px;
    }
    .game-cell {
      background: rgba(255,255,255,0.1); border-radius: 12px; cursor: pointer;
      transition: background 0.3s var(--timing-function), transform 0.2s var(--timing-function);
    }
    .game-cell:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
    .game-cell.selected {
      background: var(--accent); animation: pulse-glow 2s infinite;
    }
    .game-actions { margin-top: 32px; display: flex; gap: 16px; }
    .btn {
      padding: 12px 24px; background: var(--accent); color: white; border: none;
      border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer;
      transition: background 0.3s var(--timing-function), transform 0.3s var(--timing-function),
      box-shadow 0.3s var(--timing-function); position: relative; overflow: hidden;
    }
    .btn::before {
      content: ''; position: absolute; top: 0; left: -100%;
      width: 100%; height: 100%; background: rgba(255,255,255,0.2);
      transition: left 0.3s var(--timing-function);
    }
    .btn:hover {
      background: #0055b3; transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,102,204,0.3);
    }
    .btn:hover::before { left: 100%; }
    .btn.btn-secondary { background: rgba(255,255,255,0.2); }
    .btn.btn-secondary:hover { background: rgba(255,255,255,0.3); }
    .city-model {
      position: relative; margin-top: 48px; background: #f0f0f0;
      border-radius: 12px; height: 400px; display: flex; align-items: center;
      justify-content: center; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      transition: transform 0.5s var(--timing-function), box-shadow 0.5s var(--timing-function);
    }
    .city-model:hover {
      transform: scale(1.02); box-shadow: 0 12px 40px rgba(0,0,0,0.25);
    }
    body.dark .city-model { background: #2c2c2e; }
    .city-model::before {
      content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: url('public/lovable-uploads/bffb5b96-2cf2-4c00-b8a7-994286a708ff.png');
      background-size: cover; background-position: center; opacity: 0.7;
      transition: opacity 0.5s var(--timing-function), transform 3s var(--timing-function);
    }
    .city-model:hover::before {
      opacity: 0.9; transform: scale(1.05);
    }
    .memory-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 24px; margin-top: 32px;
    }
    .memory-card {
      height: 250px; border-radius: 12px; overflow: hidden; position: relative;
      cursor: pointer; transform-style: preserve-3d; transform: perspective(1000px) rotateY(0deg);
      transition: transform 0.6s var(--timing-function); box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    .memory-card.flipped { transform: perspective(1000px) rotateY(180deg); }
    .memory-card-front,
    .memory-card-back {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      backface-visibility: hidden; -webkit-backface-visibility: hidden;
    }
    .memory-card-front {
      background: linear-gradient(135deg, var(--accent), #004c99);
      display: flex; align-items: center; justify-content: center;
      font-size: 2rem; color: white; transform: rotateY(0deg);
    }
    .memory-card-back {
      background: white; transform: rotateY(180deg);
      display: flex; align-items: center; justify-content: center; padding: 16px;
    }
    body.dark .memory-card-back { background: #2c2c2e; }
    .memory-card-back img {
      max-width: 100%; max-height: 100%; object-fit: cover;
    }
    .memory-title {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: rgba(0,0,0,0.7); color: white; padding: 8px;
      font-size: 0.875rem; text-align: center;
    }
    .canvas-container {
      position: relative; width: 100%; max-width: 600px;
      margin: 0 auto; border-radius: 12px; overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }
    #drawingCanvas {
      width: 100%; height: 400px; background: #f5f5f7;
      cursor: crosshair; border-radius: 12px; touch-action: none;
    }
    body.dark #drawingCanvas { background: #2c2c2e; }
    .drawing-tools {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px; background: #f0f0f0; border-radius: 0 0 12px 12px;
    }
    body.dark .drawing-tools { background: #2c2c2e; }
    .color-picker { display: flex; gap: 8px; }
    .color-option {
      width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
      border: 2px solid transparent; transition: transform 0.2s var(--timing-function);
    }
    .color-option:hover, .color-option.active {
      transform: scale(1.2); border-color: white;
    }
    .brush-size { width: 120px; }
    .drawing-actions { display: flex; gap: 8px; }
    .model-score {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0); background: rgba(0,0,0,0.9);
      color: white; padding: 40px; border-radius: 20px; text-align: center;
      z-index: 2000; opacity: 0;
      transition: transform 0.5s var(--timing-function), opacity 0.5s var(--timing-function);
    }
    .model-score.active {
      transform: translate(-50%, -50%) scale(1); opacity: 1;
      animation: score-pop 0.5s var(--timing-function);
    }
    @keyframes score-pop {
      0% { transform: translate(-50%, -50%) scale(0.8); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    .score-value {
      font-size: 5rem; font-weight: 700; margin: 20px 0;
      font-family: 'Playfair Display', serif;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes blurIn {
      from { filter: blur(10px); opacity: 0; }
      to { filter: blur(0); opacity: 1; }
    }
    @keyframes floatIn {
      0% { transform: translateY(20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 5px rgba(0,102,204,0.5); }
      50% { box-shadow: 0 0 20px rgba(0,102,204,0.8); }
      100% { box-shadow: 0 0 5px rgba(0,102,204,0.5); }
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    .fade-in { animation: fadeIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .scale-in { animation: scaleIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .blur-in { animation: blurIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .float-in { animation: floatIn 1s var(--timing-function) forwards; opacity: 0; }
    .pulse-glow { animation: pulseGlow 2s infinite; }
    .wiggle { animation: wiggle 2s infinite; }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-500 { animation-delay: 0.5s; }
    @keyframes content-fade {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .browser-content-transition { animation: content-fade 0.5s var(--timing-function); }
    .section-marker { position: absolute; top: 50%; height: 1px; width: 100%; opacity: 0; }
    .tooltip {
      position: absolute; background: rgba(0,0,0,0.8); color: white;
      padding: 10px 15px; border-radius: 8px; font-size: 14px;
      z-index: 1000; pointer-events: none; opacity: 0;
      transition: opacity 0.3s var(--timing-function);
    }
    .tooltip.active { opacity: 1; }
    .tooltip::after {
      content: ''; position: absolute; bottom: -8px; left: 50%;
      transform: translateX(-50%);
      border-width: 8px 8px 0; border-style: solid;
      border-color: rgba(0,0,0,0.8) transparent transparent;
    }
    @media (max-width: 1200px) {
      .sticky-browser { width: 90%; }
      .browser-content { padding: 30px; }
    }
    @media (max-width: 768px) {
      .heading { font-size: 2.5rem; }
      .quote { font-size: 1.25rem; }
      .browser-content { padding: 20px; max-height: 65vh; }
      .game-grid {
        grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 80px);
      }
      .model-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
    }
    @media (max-width: 480px) {
      .heading { font-size: 2rem; }
      .browser-header { padding: 8px 12px; }
      .browser-dots { gap: 4px; }
      .browser-dot { width: 8px; height: 8px; }
      .browser-address { margin: 0 8px; padding: 4px 8px; font-size: 12px; }
      .browser-content { padding: 16px; max-height: 60vh; }
      .game-grid {
        grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(3, 60px); gap: 8px;
      }
      .tab { padding: 8px 12px; font-size: 0.875rem; }
      .memory-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="blindness-overlay" id="blindnessOverlay"></div>
  <div class="sticky-browser" id="stickyBrowser">
    <div class="browser-frame">
      <div class="browser-header">
        <div class="browser-dots">
          <div class="browser-dot red"></div>
          <div class="browser-dot yellow"></div>
          <div class="browser-dot green"></div>
        </div>
        <div class="browser-address" id="browserAddress">marie-laure.worldview.com</div>
        <div class="browser-buttons">
          <div class="browser-button"><i class="fa-solid fa-share"></i></div>
          <div class="browser-button"><i class="fa-solid fa-bookmark"></i></div>
        </div>
      </div>
      <div class="browser-content" id="browserContent">
        <div class="browser-content-transition">
          <h2 class="subheading active">All the Light We Cannot See</h2>
          <h1 class="heading active">The World Through Marie-Laure's Eyes</h1>
          <p class="paragraph active">Welcome to an interactive journey through the life of Marie-Laure LeBlanc, the blind protagonist from Anthony Doerr's Pulitzer Prize-winning novel. Scroll to experience her world through sight and blindness.</p>
          <blockquote class="quote active">"Open your eyes and see what you can with them before they close forever." <br>― Anthony Doerr, All the Light We Cannot See</blockquote>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <section id="intro" data-address="marie-laure.worldview.com" data-title="The World Through Marie-Laure's Eyes">
      <div class="section-marker" data-section="intro"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="sight" data-address="marie-laure.memories.com" data-title="The Last Images She Remembers">
      <div class="section-marker" data-section="sight"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="blindness" data-address="marie-laure.darkness.com" data-title="Losing Her Sight">
      <div class="section-marker" data-section="blindness"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="adaptation" data-address="marie-laure.senses.com" data-title="Learning to Navigate Through Touch">
      <div class="section-marker" data-section="adaptation"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="drawingGame" data-address="marie-laure.touch.com" data-title="Draw Papa's Model">
      <div class="section-marker" data-section="drawingGame"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="game" data-address="marie-laure.experience.com" data-title="Navigate by Memory">
      <div class="section-marker" data-section="game"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="radio" data-address="marie-laure.broadcasts.com" data-title="Radio Broadcasts">
      <div class="section-marker" data-section="radio"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="ending" data-address="marie-laure.legacy.com" data-title="Marie-Laure's Legacy">
      <div class="section-marker" data-section="ending"></div>
      <div style="height: 70vh"></div>
    </section>
  </div>
  <div class="model-game" id="modelGame">
    <div class="game-instructions">
      <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Memorize the Pattern</h2>
      <p>Study the lit squares carefully. They will disappear, and you must recreate the pattern from memory.</p>
    </div>
    <div class="game-grid" id="gameGrid">
      <div class="game-cell" data-index="0"></div>
      <div class="game-cell" data-index="1"></div>
      <div class="game-cell" data-index="2"></div>
      <div class="game-cell" data-index="3"></div>
      <div class="game-cell" data-index="4"></div>
      <div class="game-cell" data-index="5"></div>
      <div class="game-cell" data-index="6"></div>
      <div class="game-cell" data-index="7"></div>
      <div class="game-cell" data-index="8"></div>
    </div>
    <div class="game-actions">
      <button id="checkPatternBtn" class="btn" style="display: none;">Check Pattern</button>
      <button id="closeGameBtn" class="btn btn-secondary">Close</button>
    </div>
  </div>
  <div class="model-score" id="modelScore">
    <h2>Your Drawing Score</h2>
    <div class="score-value">85%</div>
    <p>You've captured most of the details of Papa's model!</p>
    <button id="closeScoreBtn" class="btn">Continue</button>
  </div>
  <div class="tooltip" id="tutorial"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sectionData = {
        intro: {
          title: "The World Through Marie-Laure's Eyes",
          content: `
            <h2 class="subheading">All the Light We Cannot See</h2>
            <h1 class="heading">The World Through Marie-Laure's Eyes</h1>
            <p class="paragraph">Welcome to an interactive journey through the life of Marie-Laure LeBlanc, the blind protagonist from Anthony Doerr's Pulitzer Prize-winning novel. Scroll to experience her world through sight and blindness.</p>
            <blockquote class="quote">"Open your eyes and see what you can with them before they close forever." <br>― Anthony Doerr, All the Light We Cannot See</blockquote>
            <div class="tabs">
              <div class="tab active" data-tab="biography">Biography</div>
              <div class="tab" data-tab="paris">Paris</div>
              <div class="tab" data-tab="models">Papa's Models</div>
            </div>
            <div class="tab-content active" id="biography">
              <p class="paragraph">Marie-Laure LeBlanc loses her sight at the age of six. Her papa, a master locksmith at the Museum of Natural History in Paris, builds her a perfect miniature model of their neighborhood so she can memorize it by touch and navigate the real streets.</p>
              <p class="paragraph">As she grows up, Marie-Laure's papa teaches her to navigate using her other senses, reading to her in braille, and helping her become more independent despite her blindness.</p>
            </div>
            <div class="tab-content" id="paris">
              <p class="paragraph">Paris in the 1930s was a city of light and life. Marie-Laure experienced it first through sight, and then through the intricate models her papa crafted for her to memorize by touch.</p>
              <p class="paragraph">Every street, every corner of their neighborhood was recreated in perfect scale, allowing Marie-Laure to form a mental map that would guide her through the real city.</p>
            </div>
            <div class="tab-content" id="models">
              <p class="paragraph">Marie-Laure's papa, a locksmith at the Museum of Natural History, crafted incredibly detailed scale models of their neighborhood for his daughter.</p>
              <p class="paragraph">These wooden models were perfect in every detail, from the number of storm drains to the benches in the parks. They became Marie-Laure's window to a world she could no longer see.</p>
              <div class="model-grid">
                <div class="model-item">
                  <img src="public/lovable-uploads/72b36500-8f71-42bc-92e5-9a93caf81e09.png" alt="Model of Saint-Malo">
                  <div class="model-title">Saint-Malo Model</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-building fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Paris Streets</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-house fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Their Home</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-tree fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Garden District</div>
                </div>
              </div>
            </div>
          `
        },
        sight: {
          title: "The Last Images She Remembers",
          content: `
            <h2 class="subheading">Early Memories</h2>
            <h1 class="heading">The Last Images She Remembers</h1>
            <p class="paragraph">Before losing her sight at age six, Marie-Laure saw the world in vibrant colors and shapes. She remembers the blue of the sky, the green of the trees in the Jardin des Plantes, and the intricate details of the museum where her papa worked.</p>
            <blockquote class="quote">"When I lost my sight, Werner, people said I was brave. When my papa left, people said I was brave. But it is not bravery; I have no choice. I wake up and live my life. Don't you do the same?"</blockquote>
            <div class="memory-grid">
              <div class="memory-card">
                <div class="memory-card-front">
                  <i class="fa-solid fa-image"></i>
                </div>
                <div class="memory-card-back">
                  <img src="public/lovable-uploads/eb44b8ab-1e86-4371-899b-a56e9cf8c153.png" alt="Paris Streets">
                  <div class="memory-title">Paris Streets</div>
                </div>
              </div>
              <div class="memory-card">
                <div class="memory-card-front">
                  <i class="fa-solid fa-image"></i>
                </div>
                <div class="memory-card-back">
                  <i class="fa-solid fa-landmark fa-4x" style="color: #8e8e93;"></i>
                  <div class="memory-title">Natural History Museum</div>
                </div>
              </div>
              <div class="memory-card">
                <div class="memory-card-front">
                  <i class="fa-solid fa-image"></i>
                </div>
                <div class="memory-card-back">
                  <i class="fa-solid fa-person fa-4x" style="color: #8e8e93;"></i>
                  <div class="memory-title">Her Papa</div>
                </div>
              </div>
              <div class="memory-card">
                <div class="memory-card-front">
                  <i class="fa-solid fa-image"></i>
                </div>
                <div class="memory-card-back">
                  <i class="fa-solid fa-book fa-4x" style="color: #8e8e93;"></i>
                  <div class="memory-title">Books</div>
                </div>
              </div>
            </div>
          `
        },
        blindness: {
          title: "Losing Her Sight",
          content: `
            <h2 class="subheading">The Darkness Comes</h2>
            <h1 class="heading">Losing Her Sight</h1>
            <p class="paragraph">At age six, Marie-Laure's world went dark. The doctors could not explain why. Cataracts, they suggested. A rare, rapid-onset form. "It's like snow," she told her papa, "but it's black snow."</p>
            <blockquote class="quote">"To shut your eyes is to guess nothing of blindness."</blockquote>
            <p class="paragraph">As you continue scrolling, you will experience what Marie-Laure experiences - a world without sight, where sound, touch, smell, and memory create a different kind of vision.</p>
          `
        },
        adaptation: {
          title: "Learning to Navigate Through Touch",
          content: `
            <h2 class="subheading">A New Kind of Sight</h2>
            <h1 class="heading">Learning to Navigate Through Touch</h1>
            <p class="paragraph">After losing her sight, Marie-Laure had to learn a new way to see the world. Her papa, determined to help her maintain her independence, built intricate wooden models of their neighborhood in Paris.</p>
            <p class="paragraph">These models became Marie-Laure's map of the world, allowing her to memorize the layout of streets and buildings by touch before venturing out into the real world.</p>
            <blockquote class="quote">"What do we call visible light? We call it color. But the electromagnetic spectrum runs to zero in one direction and infinity in the other, so really, children, mathematically, all of light is invisible."</blockquote>
            <h3 style="font-size: 1.5rem; font-weight: 600; margin: 32px 0 16px;">The Model of Saint-Malo</h3>
            <p class="paragraph">When Marie-Laure and her papa flee to Saint-Malo to escape the German occupation of Paris, he creates a new model of the walled city. This becomes crucial for her survival as she learns to navigate yet another new environment.</p>
            <div class="city-model"></div>
          `
        },
        drawingGame: {
          title: "Draw Papa's Model",
          content: `
            <h2 class="subheading">Feel What She Felt</h2>
            <h1 class="heading">Draw Papa's Model</h1>
            <p class="paragraph">Now it's your turn to create. Marie-Laure had to learn the details of her papa's models through touch. Try to draw the model of Saint-Malo as accurately as you can. Look at the reference image, then recreate it from memory.</p>
            <div style="text-align: center; margin-bottom: 24px;">
              <button id="showReferenceBtn" class="btn pulse-glow">View Reference Model</button>
              <button id="startDrawingBtn" class="btn" style="display: none;">Start Drawing</button>
            </div>
            <div id="referenceImage" style="display: none; margin-bottom: 24px; text-align: center;">
              <img src="public/lovable-uploads/72b36500-8f71-42bc-92e5-9a93caf81e09.png" alt="Saint-Malo Model" style="max-width: 100%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15);">
              <p style="margin-top: 12px; font-style: italic;">Study this model carefully. The image will disappear soon, and you'll be asked to draw it from memory.</p>
            </div>
            <div class="canvas-container" id="canvasContainer" style="display: none;">
              <canvas id="drawingCanvas" width="600" height="400"></canvas>
              <div class="drawing-tools">
                <div class="color-picker">
                  <div class="color-option active" style="background-color: #000000;" data-color="#000000"></div>
                  <div class="color-option" style="background-color: #4285F4;" data-color="#4285F4"></div>
                  <div class="color-option" style="background-color: #EA4335;" data-color="#EA4335"></div>
                  <div class="color-option" style="background-color: #FBBC05;" data-color="#FBBC05"></div>
                  <div class="color-option" style="background-color: #34A853;" data-color="#34A853"></div>
                </div>
                <input type="range" min="1" max="20" value="3" class="brush-size" id="brushSize">
                <div class="drawing-actions">
                  <button id="clearCanvas" class="btn btn-secondary"><i class="fa-solid fa-trash"></i></button>
                  <button id="submitDrawing" class="btn">Submit</button>
                </div>
              </div>
            </div>
            <blockquote class="quote">"But Papa, how did you make all those houses look so real, how did you make them look like they're leaning inward a little?"</blockquote>
          `
        },
        game: {
          title: "Navigate by Memory",
          content: `
            <h2 class="subheading">Experience Blindness</h2>
            <h1 class="heading">Navigate by Memory</h1>
            <p class="paragraph">Now it's your turn to experience what Marie-Laure did. In this interactive challenge, you'll see a pattern briefly, then it will disappear. You must recreate it from memory - much like how Marie-Laure had to memorize her papa's models.</p>
            <p class="paragraph">Click the button below to start the challenge:</p>
            <button id="startGameBtn" class="btn pulse-glow">Start Memory Challenge</button>
            <blockquote class="quote">"She walks like a ballerina in dance slippers, her feet as articulate as hands, a little vessel of grace moving out into the fog."</blockquote>
          `
        },
        radio: {
          title: "Radio Broadcasts",
          content: `
            <h2 class="subheading">The Power of Sound</h2>
            <h1 class="heading">Radio Broadcasts</h1>
            <p class="paragraph">For Marie-Laure, sound becomes an essential way to connect with the world. In Saint-Malo, she discovers her great-uncle's radio and becomes fascinated by the broadcasts that travel through the air.</p>
            <p class="paragraph">Later, during the war, radio takes on an even more significant role as Marie-Laure reads secret messages over the airwaves, becoming part of the resistance against German occupation.</p>
            <div style="margin: 40px 0; padding: 24px; background: rgba(0,102,204,0.1); border-radius: 12px; border-left: 4px solid var(--accent);" class="pulse-glow">
              <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; color: var(--accent);">
                <i class="fa-solid fa-radio" style="margin-right: 8px;"></i> Broadcast: Twenty Thousand Leagues Under the Sea
              </h3>
              <p style="font-style: italic; margin-bottom: 16px;" class="wiggle">"Whether these ranges were mountains 12,000 feet high, or fortifications 600 feet tall, the eye was unable to judge. Perhaps they were both. But they were cliffs the Canadian could not climb, caverns he could not enter, fissures he could not follow..."</p>
              <p style="font-size: 0.875rem; color: var(--subtle);">Marie-Laure broadcasting from Etienne's attic, sending coded messages to the resistance.</p>
            </div>
            <blockquote class="quote">"Radio: it ties a million ears to a single mouth."</blockquote>
          `
        },
        ending: {
          title: "Marie-Laure's Legacy",
          content: `
            <h2 class="subheading">The Light We Cannot See</h2>
            <h1 class="heading">Marie-Laure's Legacy</h1>
            <p class="paragraph">Marie-Laure's story teaches us that there are many ways to see the world. Though she lost her physical sight, she gained a deeper understanding of life through her other senses and her imagination.</p>
            <p class="paragraph">In the novel, she survives the war and goes on to become a scientist who studies mollusks, continuing her connection to the natural world that began in her childhood at the Museum of Natural History.</p>
            <blockquote class="quote">"We all come into existence as a single cell, smaller than a speck of dust. Much smaller. Divide. Multiply. Add and subtract. Matter changes hands, atoms flow in and out, molecules pivot, proteins stitch together, mitochondria send out their oxidative dictates; we begin as a microscopic electrical swarm. The lungs the brain the heart. Forty weeks later, six trillion cells get crushed in the vise of our mother's birth canal and we howl. Then the world starts in on us."</blockquote>
            <div style="margin-top: 40px; text-align: center;">
              <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 24px;">Thank You For Experiencing "All the Light We Cannot See"</h3>
              <p class="paragraph" style="text-align: center;">This interactive experience was inspired by Anthony Doerr's Pulitzer Prize-winning novel and created as a creative project for ENG2DN.</p>
            </div>
          `
        }
      };
      const progressBar = document.getElementById('progressBar');
      const blindnessOverlay = document.getElementById('blindnessOverlay');
      const browserAddress = document.getElementById('browserAddress');
      const browserContent = document.getElementById('browserContent');
      const stickyBrowser = document.getElementById('stickyBrowser');
      const sections = document.querySelectorAll('section');
      const sectionMarkers = document.querySelectorAll('.section-marker');
      const tutorial = document.getElementById('tutorial');
      let lastScrollTop = 0;
      let ticking = false;
      let currentSection = 'intro';
      let activeSections = ['intro'];
      let isFirstVisit = true;
      let lastMouseX = window.innerWidth / 2;
      let lastMouseY = window.innerHeight / 2;
      let spotlightActive = false;
      updateBrowserContent('intro');
      if (isFirstVisit) {
        showTutorial('Scroll down to explore Marie-Laure\'s story', document.body, 'bottom');
        setTimeout(() => hideTutorial(), 5000);
      }
      function handleScroll() {
        const scrollTop = window.scrollY;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrollProgress = (scrollTop / height) * 100;
        progressBar.style.width = scrollProgress + "%";
        const parallaxOffset = Math.min(Math.max((scrollTop / height) * 30 - 15, -15), 15);
        const scaleFactor = 1 - Math.abs(parallaxOffset) / 100;
        stickyBrowser.style.transform = `translate(-50%, calc(-50% + ${parallaxOffset}px)) scale(${scaleFactor})`;
        if (scrollProgress > 30 && scrollProgress < 60) {
          const blindnessIntensity = Math.min((scrollProgress - 30) / 20, 1) * 0.9;
          if (!spotlightActive) { document.addEventListener('mousemove', spotlightHandler); spotlightActive = true; }
          spotlightHandler({ clientX: lastMouseX, clientY: lastMouseY, intensity: blindnessIntensity });
          if (scrollProgress > 40) { document.body.classList.add('dark'); } else { document.body.classList.remove('dark'); }
        } else if (scrollProgress <= 30) {
          if (spotlightActive) { document.removeEventListener('mousemove', spotlightHandler); spotlightActive = false; }
          blindnessOverlay.style.background = 'rgba(0,0,0,0)';
          document.body.classList.remove('dark');
        }
        determineCurrentSection();
        lastScrollTop = scrollTop;
        ticking = false;
      }
      function spotlightHandler(e) {
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
        const intensity = e.intensity !== undefined ? e.intensity : 0.9;
        blindnessOverlay.style.background = `radial-gradient(circle at ${e.clientX}px ${e.clientY}px, transparent 120px, rgba(0,0,0,${intensity}) 180px)`;
      }
      function determineCurrentSection() {
        let newCurrentSection = currentSection;
        sectionMarkers.forEach(marker => {
          const rect = marker.getBoundingClientRect();
          if (rect.top >= -window.innerHeight * 0.3 && rect.top <= window.innerHeight * 0.7) {
            newCurrentSection = marker.getAttribute('data-section');
          }
        });
        if (newCurrentSection !== currentSection) {
          currentSection = newCurrentSection;
          updateBrowserContent(currentSection);
          const newAddress = document.querySelector(`section[id="${currentSection}"]`).getAttribute('data-address');
          animateAddressChange(newAddress);
          if (!activeSections.includes(currentSection)) {
            activeSections.push(currentSection);
            if (currentSection === 'drawingGame') {
              setTimeout(() => {
                showTutorial('Click "View Reference Model" to start the drawing game', document.getElementById('showReferenceBtn'), 'top');
                setTimeout(() => hideTutorial(), 5000);
              }, 1000);
            }
            if (currentSection === 'game') {
              setTimeout(() => {
                showTutorial('Test your memory like Marie-Laure had to', document.getElementById('startGameBtn'), 'top');
                setTimeout(() => hideTutorial(), 5000);
              }, 1000);
            }
          }
        }
      }
      function updateBrowserContent(sectionId) {
        const section = sectionData[sectionId];
        if (!section) return;
        const contentWrapper = document.createElement('div');
        contentWrapper.className = 'browser-content-transition';
        contentWrapper.innerHTML = section.content;
        browserContent.innerHTML = '';
        browserContent.appendChild(contentWrapper);
        setTimeout(() => {
          activateElements(browserContent);
          attachEventListeners();
        }, 100);
      }
      function animateAddressChange(newAddress) {
        browserAddress.classList.add('wiggle');
        browserAddress.style.opacity = '0';
        setTimeout(() => {
          browserAddress.textContent = newAddress;
          browserAddress.style.opacity = '1';
          setTimeout(() => { browserAddress.classList.remove('wiggle'); }, 1000);
        }, 300);
      }
      function activateElements(container) {
        const elements = container.querySelectorAll('.heading, .subheading, .paragraph, .quote, .tabs');
        elements.forEach(el => el.classList.add('active'));
      }
      function attachEventListeners() {
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            document.querySelectorAll('.tab-content').forEach(content => { content.classList.remove('active'); });
            document.querySelectorAll('.tab').forEach(t => { t.classList.remove('active'); });
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
          });
        });
        document.querySelectorAll('.memory-card').forEach(card => {
          card.addEventListener('click', function() { this.classList.toggle('flipped'); });
        });
        const showReferenceBtn = document.getElementById('showReferenceBtn');
        const startDrawingBtn = document.getElementById('startDrawingBtn');
        if (showReferenceBtn && startDrawingBtn) { setupDrawingGame(); }
        const startGameBtn = document.getElementById('startGameBtn');
        if (startGameBtn) {
          startGameBtn.addEventListener('click', function() {
            document.getElementById('modelGame').classList.add('active');
            startMemoryGame();
          });
        }
      }
      function setupDrawingGame() {
        const showReferenceBtn = document.getElementById('showReferenceBtn');
        const startDrawingBtn = document.getElementById('startDrawingBtn');
        const referenceImage = document.getElementById('referenceImage');
        const canvasContainer = document.getElementById('canvasContainer');
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const clearCanvasBtn = document.getElementById('clearCanvas');
        const submitDrawingBtn = document.getElementById('submitDrawing');
        const colorOptions = document.querySelectorAll('.color-option');
        const brushSize = document.getElementById('brushSize');
        const modelScore = document.getElementById('modelScore');
        const closeScoreBtn = document.getElementById('closeScoreBtn');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = '#000000';
        let currentBrushSize = 3;
        showReferenceBtn.addEventListener('click', function() {
          referenceImage.style.display = 'block';
          showReferenceBtn.style.display = 'none';
          startDrawingBtn.style.display = 'inline-block';
          setTimeout(() => {
            if (referenceImage.style.display === 'block') {
              referenceImage.style.display = 'none';
              startDrawingBtn.click();
            }
          }, 10000);
          showTutorial('Study this model carefully! It will disappear in 10 seconds', referenceImage, 'top');
          setTimeout(() => hideTutorial(), 4000);
        });
        startDrawingBtn.addEventListener('click', function() {
          referenceImage.style.display = 'none';
          canvasContainer.style.display = 'block';
          startDrawingBtn.style.display = 'none';
          resizeCanvas();
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = currentBrushSize;
          showTutorial('Draw the model from memory as best you can', canvas, 'top');
          setTimeout(() => hideTutorial(), 4000);
        });
        function resizeCanvas() {
          const containerWidth = canvasContainer.offsetWidth;
          canvas.width = containerWidth;
          canvas.height = (containerWidth * 2) / 3;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = currentBrushSize;
        }
        window.addEventListener('resize', resizeCanvas);
        function startDrawingStroke(e) {
          isDrawing = true;
          const coords = getCoordinates(e);
          lastX = coords.x;
          lastY = coords.y;
        }
        function drawStroke(e) {
          if (!isDrawing) return;
          const coords = getCoordinates(e);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(coords.x, coords.y);
          ctx.stroke();
          lastX = coords.x;
          lastY = coords.y;
        }
        function endDrawingStroke() { isDrawing = false; }
        function getCoordinates(e) {
          let x, y;
          if (e.type.includes('touch')) {
            x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
            y = e.touches[0].clientY - canvas.getBoundingClientRect().top;
          } else { x = e.offsetX; y = e.offsetY; }
          return { x, y };
        }
        canvas.addEventListener('mousedown', startDrawingStroke);
        canvas.addEventListener('mousemove', drawStroke);
        canvas.addEventListener('mouseup', endDrawingStroke);
        canvas.addEventListener('mouseout', endDrawingStroke);
        canvas.addEventListener('touchstart', function(e) { e.preventDefault(); startDrawingStroke(e); });
        canvas.addEventListener('touchmove', function(e) { e.preventDefault(); drawStroke(e); });
        canvas.addEventListener('touchend', endDrawingStroke);
        colorOptions.forEach(option => {
          option.addEventListener('click', function() {
            colorOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            currentColor = this.getAttribute('data-color');
            ctx.strokeStyle = currentColor;
          });
        });
        brushSize.addEventListener('input', function() {
          currentBrushSize = this.value;
          ctx.lineWidth = currentBrushSize;
        });
        clearCanvasBtn.addEventListener('click', function() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
        submitDrawingBtn.addEventListener('click', function() {
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          let nonEmptyPixels = 0;
          for (let i = 0; i < data.length; i += 4) {
            if (data[i + 3] > 0) { nonEmptyPixels++; }
          }
          const complexityPercentage = Math.min(nonEmptyPixels / (canvas.width * canvas.height * 0.05), 1);
          const baseScore = 70;
          const score = Math.round(baseScore + (complexityPercentage * 25));
          document.querySelector('.score-value').textContent = score + '%';
          let message;
          if (score >= 90) { message = "Excellent! Your drawing captures Papa's model perfectly!"; }
          else if (score >= 80) { message = "Great job! You've captured most of the details of Papa's model!"; }
          else { message = "Good attempt! With practice, you'll learn to notice more details, just like Marie-Laure."; }
          document.querySelector('#modelScore p').textContent = message;
          modelScore.classList.add('active');
          canvasContainer.style.display = 'none';
        });
        closeScoreBtn.addEventListener('click', function() { modelScore.classList.remove('active'); });
      }
      function startMemoryGame() {
        const modelGame = document.getElementById('modelGame');
        const closeGameBtn = document.getElementById('closeGameBtn');
        const checkPatternBtn = document.getElementById('checkPatternBtn');
        const gameGrid = document.getElementById('gameGrid');
        const gameCells = document.querySelectorAll('.game-cell');
        let pattern = [];
        let userPattern = [];
        let gameState = 'inactive';
        let gameLevel = 1;
        let correctAnswers = 0;
        closeGameBtn.addEventListener('click', function() {
          modelGame.classList.remove('active');
          resetGame();
        });
        gameState = 'showing';
        pattern = generateRandomPattern(gameLevel);
        userPattern = [];
        document.querySelector('.game-instructions').innerHTML = `
          <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Memorize the Pattern</h2>
          <p>Study the lit squares carefully. They will disappear, and you must recreate the pattern from memory.</p>
          <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">This is how Marie-Laure had to memorize her papa's models by touch.</p>
        `;
        setTimeout(() => {
          pattern.forEach((index, i) => {
            setTimeout(() => { gameCells[index].classList.add('selected'); }, i * 600);
            setTimeout(() => { gameCells[index].classList.remove('selected'); }, (i * 600) + 500);
          });
          setTimeout(() => {
            gameState = 'selecting';
            checkPatternBtn.style.display = 'block';
            document.querySelector('.game-instructions').innerHTML = `
              <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Recreate the Pattern</h2>
              <p>Click on the squares to recreate the pattern you just saw.</p>
              <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Marie-Laure had to remember the layout of her neighborhood through touch alone.</p>
            `;
          }, (pattern.length * 600) + 1000);
        }, 1500);
        gameCells.forEach(cell => {
          cell.addEventListener('click', function() {
            if (gameState !== 'selecting') return;
            const index = parseInt(this.getAttribute('data-index'));
            if (this.classList.contains('selected')) {
              this.classList.remove('selected');
              userPattern = userPattern.filter(i => i !== index);
            } else {
              this.classList.add('selected');
              userPattern.push(index);
            }
          });
        });
        checkPatternBtn.addEventListener('click', function() {
          if (gameState !== 'selecting') return;
          const correct = comparePatterns(pattern, userPattern);
          if (correct) {
            correctAnswers++;
            gameLevel++;
            document.querySelector('.game-instructions').innerHTML = `
              <h2 style="margin-bottom: 16px; font-size: 1.75rem; color: #34c759;">Correct!</h2>
              <p>Great job! You're learning to navigate through memory, just like Marie-Laure did with her papa's models.</p>
              <p style="margin-top: 16px;">Get ready for level ${gameLevel}...</p>
            `;
            gameCells.forEach(cell => {
              cell.style.animation = 'pulseGlow 0.5s';
              setTimeout(() => { cell.style.animation = ''; }, 500);
            });
            setTimeout(() => { resetGameGrid(); startNextLevel(); }, 3000);
          } else {
            document.querySelector('.game-instructions').innerHTML = `
              <h2 style="margin-bottom: 16px; font-size: 1.75rem; color: #ff3b30;">Not Quite Right</h2>
              <p>This is how Marie-Laure must have felt when learning a new route - it takes practice!</p>
              <p style="margin-top: 16px;">Let's see the correct pattern...</p>
            `;
            setTimeout(() => {
              resetGameGrid();
              pattern.forEach(index => {
                gameCells[index].classList.add('selected');
                gameCells[index].style.backgroundColor = '#34c759';
              });
              setTimeout(() => { resetGameGrid(); startNextLevel(); }, 2000);
            }, 1500);
          }
        });
        function startNextLevel() {
          gameState = 'showing';
          pattern = generateRandomPattern(gameLevel);
          userPattern = [];
          document.querySelector('.game-instructions').innerHTML = `
            <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Memorize the Pattern</h2>
            <p>Study the lit squares carefully. They will disappear, and you must recreate the pattern from memory.</p>
            <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Your score: ${correctAnswers} correct</p>
          `;
          checkPatternBtn.style.display = 'none';
          pattern.forEach((index, i) => {
            setTimeout(() => { gameCells[index].classList.add('selected'); }, i * 600);
            setTimeout(() => { gameCells[index].classList.remove('selected'); }, (i * 600) + 500);
          });
          setTimeout(() => {
            gameState = 'selecting';
            checkPatternBtn.style.display = 'block';
            document.querySelector('.game-instructions').innerHTML = `
              <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Recreate the Pattern</h2>
              <p>Click on the squares to recreate the pattern you just saw.</p>
              <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Your score: ${correctAnswers} correct</p>
            `;
          }, (pattern.length * 600) + 1000);
        }
        function generateRandomPattern(level) {
          const patternLength = Math.min(3 + Math.floor(level / 2), 7);
          const pattern = [];
          while (pattern.length < patternLength) {
            const randomIndex = Math.floor(Math.random() * 9);
            if (!pattern.includes(randomIndex)) { pattern.push(randomIndex); }
          }
          return pattern;
        }
        function comparePatterns(pattern1, pattern2) {
          if (pattern1.length !== pattern2.length) return false;
          const sorted1 = [...pattern1].sort((a, b) => a - b);
          const sorted2 = [...pattern2].sort((a, b) => a - b);
          return sorted1.every((value, index) => value === sorted2[index]);
        }
        function resetGameGrid() {
          gameCells.forEach(cell => {
            cell.classList.remove('selected');
            cell.style.backgroundColor = '';
          });
          userPattern = [];
        }
        function resetGame() {
          gameState = 'inactive';
          pattern = [];
          userPattern = [];
          checkPatternBtn.style.display = 'none';
          resetGameGrid();
          document.querySelector('.game-instructions').innerHTML = `
            <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Memorize the Pattern</h2>
            <p>Study the lit squares carefully. They will disappear, and you must recreate the pattern from memory.</p>
          `;
        }
      }
      function showTutorial(message, targetElement, position) {
        if (!targetElement) return;
        const tooltip = document.getElementById('tutorial');
        tooltip.textContent = message;
        tooltip.classList.add('active');
        const targetRect = targetElement.getBoundingClientRect();
        let top, left;
        switch(position) {
          case 'top':
            top = targetRect.top - tooltip.offsetHeight - 10;
            left = targetRect.left + (targetRect.width / 2) - (tooltip.offsetWidth / 2);
            break;
          case 'bottom':
            top = targetRect.bottom + 10;
            left = targetRect.left + (targetRect.width / 2) - (tooltip.offsetWidth / 2);
            break;
          case 'left':
            top = targetRect.top + (targetRect.height / 2) - (tooltip.offsetHeight / 2);
            left = targetRect.left - tooltip.offsetWidth - 10;
            break;
          case 'right':
            top = targetRect.top + (targetRect.height / 2) - (tooltip.offsetHeight / 2);
            left = targetRect.right + 10;
            break;
          default:
            top = targetRect.top - tooltip.offsetHeight - 10;
            left = targetRect.left + (targetRect.width / 2) - (tooltip.offsetWidth / 2);
        }
        if (left < 10) left = 10;
        if (left + tooltip.offsetWidth > window.innerWidth - 10) { left = window.innerWidth - tooltip.offsetWidth - 10; }
        if (top < 10) top = targetRect.bottom + 10;
        if (top + tooltip.offsetHeight > window.innerHeight - 10) { top = targetRect.top - tooltip.offsetHeight - 10; }
        tooltip.style.top = `${top}px`;
        tooltip.style.left = `${left}px`;
      }
      function hideTutorial() { document.getElementById('tutorial').classList.remove('active'); }
      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      });
      handleScroll();
    });
  </script>
</body>
</html>
