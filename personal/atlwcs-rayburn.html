<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All the Light We Cannot See - Interactive Experience</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0a0a0f;
      --secondary: #f7f7f9;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --subtle: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
      --box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
      --text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      --border-radius: 16px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E");
      opacity: 0.15;
      pointer-events: none;
      z-index: 10;
      animation: noiseJump 0.3s steps(2) infinite;
    }
    @keyframes noiseJump {
      0% { transform: translate(0px, 0px); }
      10% { transform: translate(-2px, 1px); }
      20% { transform: translate(2px, -1px); }
      30% { transform: translate(-1px, -2px); }
      40% { transform: translate(1px, 2px); }
      50% { transform: translate(-2px, 1px); }
      60% { transform: translate(2px, -1px); }
      70% { transform: translate(-1px, -2px); }
      80% { transform: translate(1px, 2px); }
      90% { transform: translate(-2px, 1px); }
      100% { transform: translate(0px, 0px); }
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: var(--primary);
      background-color: var(--secondary);
      overflow-x: hidden;
      transition: background-color 0.5s var(--timing-function);
      line-height: 1.6;
    }
    body.dark {
      background-color: var(--primary);
      color: var(--secondary);
      --box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5);
    }
    .container {
      width: 100%;
      padding: 0;
      position: relative;
    }
    .progress-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 2000;
      backdrop-filter: blur(4px);
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-hover));
      width: 0%;
      transition: width 0.1s ease;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
      border-radius: 0 4px 4px 0;
    }
    .sticky-browser {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      z-index: 100;
      width: 92%;
      max-width: 1080px;
      opacity: 1;
      transform-origin: center;
      transition: opacity 0.5s var(--timing-function), transform 0.5s var(--timing-function);
      perspective: 1500px;
    }
    section {
      min-height: 100vh;
      padding: 15vh 0;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .browser-frame {
      width: 100%;
      max-width: 1080px;
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
      margin: 0 auto;
      transition: all 0.8s var(--timing-function);
      transform: translateY(0) rotateX(0deg);
      will-change: transform;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    .browser-frame:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px -5px rgba(0, 0, 0, 0.2);
    }
    body.dark .browser-frame {
      background: #121218;
      border-color: rgba(255, 255, 255, 0.05);
    }
    .browser-header {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      background: #f0f0f5;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      backdrop-filter: blur(5px);
    }
    body.dark .browser-header {
      background: #1a1a22;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .browser-dots {
      display: flex;
      gap: 8px;
    }
    .browser-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      transition: transform 0.2s var(--timing-function);
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1);
    }
    body.dark .browser-dot {
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    .browser-dot:hover {
      transform: scale(1.2);
    }
    .browser-dot.red {
      background: linear-gradient(145deg, #ff5f57, #ff4f47);
    }
    .browser-dot.yellow {
      background: linear-gradient(145deg, #febc2e, #feac1e);
    }
    .browser-dot.green {
      background: linear-gradient(145deg, #28c840, #18b830);
    }
    .browser-address {
      flex: 1;
      margin: 0 16px;
      padding: 10px 16px;
      background: rgba(230, 230, 240, 0.8);
      border-radius: 8px;
      color: #333;
      font-size: 14px;
      text-align: center;
      font-family: 'Inter', sans-serif;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: all 0.3s var(--timing-function);
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(4px);
    }
    .browser-address:hover {
      background: rgba(220, 220, 230, 0.9);
    }
    body.dark .browser-address {
      background: rgba(40, 40, 50, 0.8);
      color: #f0f0f5;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    body.dark .browser-address:hover {
      background: rgba(50, 50, 60, 0.9);
    }
    .browser-buttons {
      display: flex;
      gap: 16px;
    }
    .browser-button {
      color: var(--subtle);
      font-size: 16px;
      transition: color 0.3s var(--timing-function), transform 0.2s var(--timing-function);
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }
    .browser-button:hover {
      color: var(--accent);
      transform: scale(1.1);
      background: rgba(59, 130, 246, 0.1);
    }
    .browser-content {
      padding: 45px;
      min-height: 60vh;
      position: relative;
      background: white;
      transition: background-color 0.5s var(--timing-function);
      overflow-y: auto;
      max-height: 70vh;
      scrollbar-width: thin;
      scrollbar-color: var(--subtle) transparent;
    }
    .browser-content::-webkit-scrollbar {
      width: 6px;
    }
    .browser-content::-webkit-scrollbar-track {
      background: transparent;
    }
    .browser-content::-webkit-scrollbar-thumb {
      background-color: var(--subtle);
      border-radius: 6px;
    }
    body.dark .browser-content {
      background: #121218;
    }
    .heading {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 3.75rem;
      margin-bottom: 28px;
      line-height: 1.2;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.3s, transform 0.8s var(--timing-function) 0.3s;
      text-shadow: var(--text-shadow);
      background: linear-gradient(135deg, var(--primary), #454551);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    body.dark .heading {
      background: linear-gradient(135deg, var(--secondary), #c8c8d0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .heading.active {
      opacity: 1;
      transform: translateY(0);
    }
    .subheading {
      font-family: 'Playfair Display', serif;
      font-weight: 500;
      font-size: 1.625rem;
      margin-bottom: 18px;
      color: var(--accent);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.5s, transform 0.8s var(--timing-function) 0.5s;
      letter-spacing: 0.01em;
    }
    .subheading.active {
      opacity: 1;
      transform: translateY(0);
    }
    .paragraph {
      font-size: 1.125rem;
      line-height: 1.7;
      margin-bottom: 28px;
      max-width: 800px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.7s, transform 0.8s var(--timing-function) 0.7s;
      color: rgba(10, 10, 15, 0.8);
    }
    body.dark .paragraph {
      color: rgba(247, 247, 249, 0.8);
    }
    .paragraph.active {
      opacity: 1;
      transform: translateY(0);
    }
    .quote {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-style: italic;
      color: var(--accent);
      margin: 45px 0;
      padding: 20px 30px;
      border-left: 4px solid var(--accent);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.9s, transform 0.8s var(--timing-function) 0.9s;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
      box-shadow: 0 4px 12px -2px rgba(59, 130, 246, 0.1);
      line-height: 1.6;
    }
    body.dark .quote {
      background: rgba(59, 130, 246, 0.1);
      box-shadow: 0 4px 12px -2px rgba(59, 130, 246, 0.2);
    }
    .quote.active {
      opacity: 1;
      transform: translateY(0);
    }
    .tabs {
      display: flex;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      margin: 36px 0;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s var(--timing-function) 0.7s, transform 0.8s var(--timing-function) 0.7s;
      overflow-x: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar {
      display: none;
    }
    body.dark .tabs {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .tabs.active {
      opacity: 1;
      transform: translateY(0);
    }
    .tab {
      padding: 14px 28px;
      font-weight: 500;
      cursor: pointer;
      position: relative;
      color: var(--subtle);
      transition: color 0.3s var(--timing-function);
      white-space: nowrap;
    }
    .tab:hover {
      color: var(--accent);
    }
    .tab.active {
      color: var(--accent);
    }
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--accent);
      transform: scaleX(0);
      animation: tab-indicator 0.3s forwards var(--timing-function);
      transform-origin: left;
      border-radius: 2px 2px 0 0;
    }
    @keyframes tab-indicator {
      from { transform: scaleX(0); }
      to { transform: scaleX(1); }
    }
    .tab-content {
      padding: 36px 0;
      display: none;
      animation: fade-in 0.5s var(--timing-function);
    }
    .tab-content.active {
      display: block;
    }
    .blindness-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      pointer-events: none;
      z-index: 900;
      transition: background 0.5s ease-out;
      mix-blend-mode: multiply;
    }
    .model-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 24px;
      margin-top: 36px;
    }
    .model-item {
      height: 180px;
      background: #f5f5f7;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.3s var(--timing-function), box-shadow 0.3s var(--timing-function);
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
    }
    body.dark .model-item {
      background: #1a1a22;
    }
    .model-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    .model-item img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      transition: transform 0.5s var(--timing-function);
    }
    .model-item:hover img {
      transform: scale(1.08);
    }
    .model-title {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));
      color: white;
      padding: 24px 12px 12px;
      font-size: 0.875rem;
      text-align: center;
      transform: translateY(100%);
      transition: transform 0.4s var(--timing-function);
    }
    .model-item:hover .model-title {
      transform: translateY(0);
    }
    .model-game {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.98);
      z-index: 1000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 28px;
      opacity: 0;
      transition: opacity 0.5s var(--timing-function);
      backdrop-filter: blur(10px);
    }
    .model-game.active {
      display: flex;
      opacity: 1;
      animation: scaleIn 0.4s var(--timing-function);
    }
    .game-instructions {
      color: white;
      font-size: 1.25rem;
      text-align: center;
      margin-bottom: 36px;
      max-width: 640px;
      animation: floatIn 0.8s var(--timing-function) forwards;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .game-grid {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 16px;
      perspective: 1000px;
    }
    .game-cell {
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s var(--timing-function);
      transform-style: preserve-3d;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      animation: floatIn 0.6s var(--timing-function) forwards;
      opacity: 0;
    }
    .game-cell:nth-child(1) { animation-delay: 0.1s; }
    .game-cell:nth-child(2) { animation-delay: 0.15s; }
    .game-cell:nth-child(3) { animation-delay: 0.2s; }
    .game-cell:nth-child(4) { animation-delay: 0.25s; }
    .game-cell:nth-child(5) { animation-delay: 0.3s; }
    .game-cell:nth-child(6) { animation-delay: 0.35s; }
    .game-cell:nth-child(7) { animation-delay: 0.4s; }
    .game-cell:nth-child(8) { animation-delay: 0.45s; }
    .game-cell:nth-child(9) { animation-delay: 0.5s; }
    .game-cell:hover {
      background: rgba(255,255,255,0.15);
      transform: translateZ(10px) scale(1.05);
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    .game-cell.selected {
      background: var(--accent);
      animation: pulse-glow 1.5s infinite alternate;
      box-shadow: 0 0 15px var(--accent), 0 0 30px rgba(59, 130, 246, 0.4);
      border-color: rgba(255,255,255,0.3);
    }
    .game-cell.correct-pattern {
        background-color: #10b981 !important;
        animation: none !important;
        box-shadow: 0 0 15px var(--success), 0 0 30px rgba(16, 185, 129, 0.4);
    }
    .game-actions {
      margin-top: 36px;
      display: flex;
      gap: 16px;
      animation: floatIn 0.8s var(--timing-function) 0.4s forwards;
      opacity: 0;
    }
    .btn {
      padding: 12px 30px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s var(--timing-function);
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3), 0 1px 3px rgba(0,0,0,0.1);
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.2);
      transition: left 0.3s var(--timing-function);
    }
    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4), 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    .btn:hover::before {
      left: 100%;
    }
    .btn.btn-secondary {
      background: rgba(255,255,255,0.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.1);
    }
    .btn.btn-secondary:hover {
      background: rgba(255,255,255,0.25);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.2);
    }
    .city-model {
      position: relative;
      margin-top: 54px;
      background: #f5f5f7;
      border-radius: var(--border-radius);
      height: 420px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      transition: transform 0.5s var(--timing-function), box-shadow 0.5s var(--timing-function);
    }
    .city-model:hover {
      transform: scale(1.02);
      box-shadow: 0 16px 48px rgba(0,0,0,0.25);
    }
    body.dark .city-model {
      background: #1a1a22;
    }
    .city-model::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://dnm.nflximg.net/api/v6/2DuQlx0fM4wd1nzqm5BFBi6ILa8/AAAAQUez8BMh95E1QeRI-lCGZ4vWaHLuBs63k5C-VPsjhs_NlPxGfSA_srp1NOaHKeowl-fAJuKDJGfNFh36AKWTGCM1SxwXknpRY8KEzJGtNIs11zsYhRt2MtuDpkTHC8uTrNa5MuLast61FKmBTR4BrwSH.jpg?r=d59');
      background-size: cover;
      background-position: center;
      opacity: 0.7;
      transition: opacity 0.6s var(--timing-function), transform 4s var(--timing-function);
      filter: brightness(1.05) contrast(1.1);
    }
    .city-model:hover::before {
      opacity: 0.9;
      transform: scale(1.05);
    }
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 28px;
      margin-top: 36px;
    }
    .memory-card {
      height: 280px;
      border-radius: var(--border-radius);
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transform-style: preserve-3d;
      transform: perspective(1000px) rotateY(0deg);
      transition: transform 0.7s var(--timing-function);
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    }
    .memory-card.flipped {
      transform: perspective(1000px) rotateY(180deg);
    }
    .memory-card-front,
    .memory-card-back {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      transition: box-shadow 0.3s var(--timing-function);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--border-radius);
    }
    .memory-card:hover .memory-card-front,
    .memory-card:hover .memory-card-back {
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }
    .memory-card-front {
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      font-size: 2.25rem;
      color: white;
      transform: rotateY(0deg);
      overflow: hidden;
    }
    .memory-card-front::after {
      content: '';
      position: absolute;
      width: 150%;
      height: 150%;
      background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
      top: -25%;
      left: -25%;
      opacity: 0;
      transition: opacity 0.5s var(--timing-function);
    }
    .memory-card:hover .memory-card-front::after {
      opacity: 1;
    }
    .memory-card-back {
      background: white;
      transform: rotateY(180deg);
      padding: 18px;
    }
    body.dark .memory-card-back {
      background: #1a1a22;
    }
    .memory-card-back img,
    .memory-card-back i {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .memory-title {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0.5) 70%, rgba(0,0,0,0));
      color: white;
      padding: 24px 12px 12px;
      font-size: 0.95rem;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      z-index: 1;
    }
    .canvas-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: 0 12px 36px rgba(0,0,0,0.15);
    }
    #drawingCanvas {
      width: 100%;
      height: 400px;
      background: #f5f5f7;
      cursor: crosshair;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      touch-action: none;
      transition: background-color 0.3s var(--timing-function);
      display: block;
    }
    body.dark #drawingCanvas {
      background: #1a1a22;
    }
    .drawing-tools {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      padding: 16px;
      background: #f0f0f5;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      transition: background-color 0.3s var(--timing-function);
    }
    body.dark .drawing-tools {
      background: #212128;
    }
    .color-picker {
      display: flex;
      gap: 10px;
    }
    .color-option {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s var(--timing-function);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .color-option:hover, .color-option.active {
      transform: scale(1.2);
      border-color: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .brush-size {
      width: 130px;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      background: rgba(0,0,0,0.1);
      border-radius: 3px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      outline: none;
      cursor: pointer;
    }
    body.dark .brush-size {
      background: rgba(255,255,255,0.1);
    }
    .brush-size::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: all 0.2s var(--timing-function);
    }
     .brush-size::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: all 0.2s var(--timing-function);
    }
    .brush-size::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: var(--accent-hover);
    }
     .brush-size::-moz-range-thumb:hover {
      transform: scale(1.1);
      background: var(--accent-hover);
    }
    .drawing-actions {
      display: flex;
      gap: 10px;
    }
    .drawing-actions button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s var(--timing-function);
    }
    .drawing-actions button.btn-secondary {
       background: var(--subtle);
    }
    .drawing-actions button.btn-secondary:hover {
        background: #4a5568;
        transform: translateY(-2px);
    }
    .drawing-actions button:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }
    .model-score {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(15, 15, 20, 0.95);
      color: white;
      padding: 45px;
      border-radius: 24px;
      text-align: center;
      z-index: 2000;
      opacity: 0;
      transition: transform 0.5s var(--timing-function), opacity 0.5s var(--timing-function);
      backdrop-filter: blur(8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
      max-width: 90%;
      width: 360px;
    }
    .model-score.active {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      animation: score-pop 0.5s var(--timing-function);
    }
    @keyframes score-pop {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
      70% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    .score-value {
      font-size: 5.5rem;
      font-weight: 700;
      margin: 24px 0;
      font-family: 'Playfair Display', serif;
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      text-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes blurIn {
      from { filter: blur(10px); opacity: 0; }
      to { filter: blur(0); opacity: 1; }
    }
    @keyframes floatIn {
      0% { transform: translateY(20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    @keyframes pulse-glow {
        0% { box-shadow: 0 0 8px rgba(59, 130, 246, 0.6), 0 0 15px rgba(59, 130, 246, 0.3); }
        100% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.5); }
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(-2deg); }
      50% { transform: rotate(2deg); }
    }
    .fade-in { animation: fadeIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .scale-in { animation: scaleIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .blur-in { animation: blurIn 0.8s var(--timing-function) forwards; opacity: 0; }
    .float-in { animation: floatIn 1s var(--timing-function) forwards; opacity: 0; }
    .pulse-glow { animation: pulse-glow 2s infinite alternate; }
    .wiggle { animation: wiggle 2.5s infinite ease-in-out; }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-500 { animation-delay: 0.5s; }
    @keyframes content-fade {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .browser-content-transition {
      animation: content-fade 0.6s var(--timing-function);
    }
    .section-marker {
      position: absolute;
      top: 50%;
      height: 1px;
      width: 100%;
      opacity: 0;
      pointer-events: none;
    }
    .tooltip {
      position: fixed;
      background: rgba(15, 15, 20, 0.9);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 3000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s var(--timing-function), transform 0.3s var(--timing-function);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1);
      transform: translateY(5px);
      backdrop-filter: blur(4px);
      max-width: 250px;
      text-align: center;
    }
    .tooltip.active {
      opacity: 1;
      transform: translateY(0);
    }
    .tooltip::after {
      content: none;
    }
    @media (max-width: 1200px) {
      .sticky-browser { width: 92%; }
      .browser-content { padding: 36px; }
      .heading { font-size: 3.25rem; }
    }
    @media (max-width: 768px) {
      .heading { font-size: 2.75rem; }
      .quote { font-size: 1.25rem; padding: 15px 24px; margin: 36px 0; }
      .browser-content { padding: 24px; max-height: 65vh; }
      .browser-frame:hover { transform: none; }
      .game-grid {
        grid-template-columns: repeat(3, 80px);
        grid-template-rows: repeat(3, 80px);
        gap: 12px;
      }
      .model-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
      .browser-header { padding: 12px 16px; }
      .drawing-tools { justify-content: center; }
    }
    @media (max-width: 480px) {
      .heading { font-size: 2.25rem; }
      .subheading { font-size: 1.375rem; }
      .paragraph { font-size: 1rem; }
      .browser-header { padding: 10px 12px; flex-wrap: wrap; }
      .browser-dots { gap: 6px; }
      .browser-dot { width: 10px; height: 10px; }
      .browser-address { margin: 5px 8px 0; padding: 6px 10px; font-size: 12px; order: 3; width: calc(100% - 16px); }
      .browser-buttons { order: 2; margin-left: auto; }
      .browser-content { padding: 20px; max-height: 60vh; }
      .game-grid {
        grid-template-columns: repeat(3, 70px);
        grid-template-rows: repeat(3, 70px);
        gap: 8px;
      }
      .tab { padding: 10px 14px; font-size: 0.875rem; }
      .memory-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 16px; }
      .memory-card { height: 220px; }
      .model-score { padding: 30px; width: calc(100% - 40px); max-width: 320px;}
      .score-value { font-size: 4.5rem; }
      .papa-bubble { max-width: calc(100% - 40px); left: 10px; bottom: 60px; }
      .toggle-blindness-btn { bottom: 10px; right: 10px; }
    }
    .papa-bubble {
      position: fixed;
      bottom: 20px;
      left: 20px;
      max-width: 280px;
      padding: 12px 18px;
      background: rgba(10, 10, 15, 0.95);
      color: #f0f0f5;
      border-radius: 12px;
      box-shadow: 0 8px 25px -3px rgba(0, 0, 0, 0.4);
      font-family: 'Inter', sans-serif;
      z-index: 3500;
      line-height: 1.5;
      transition: opacity 0.4s ease, transform 0.4s ease;
      opacity: 0;
      transform: translateY(15px);
      pointer-events: none;
    }
    .papa-bubble.visible {
        opacity: 1;
        transform: translateY(0);
    }
    .papa-bubble .papa-label {
        display: block;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: var(--accent);
    }
     .papa-bubble .papa-message {
        font-size: 0.95rem;
     }
    .papa-bubble .loading-dots span {
        display: inline-block;
        width: 6px;
        height: 6px;
        background-color: var(--accent);
        border-radius: 50%;
        margin: 0 2px;
        animation: bounce 1.4s infinite ease-in-out both;
    }
    .papa-bubble .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .papa-bubble .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
    }
    .toggle-blindness-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 3600;
        padding: 10px 15px;
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease;
    }
     .toggle-blindness-btn.disabled {
        background-color: var(--subtle);
     }
    /* Idle overlay styles */
    .idle-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(250,250,250,0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 5000;
      padding: 20px;
      font-family: 'Inter', sans-serif;
      color: var(--primary);
      font-size: 1.2rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    .idle-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="blindness-overlay" id="blindnessOverlay"></div>
  <div class="sticky-browser" id="stickyBrowser">
    <div class="browser-frame">
      <div class="browser-header">
        <div class="browser-dots">
          <div class="browser-dot red"></div>
          <div class="browser-dot yellow"></div>
          <div class="browser-dot green"></div>
        </div>
        <div class="browser-address" id="browserAddress">marie-laure.worldview.com</div>
        <div class="browser-buttons">
          <div class="browser-button"><i class="fa-solid fa-share"></i></div>
          <div class="browser-button"><i class="fa-solid fa-bookmark"></i></div>
        </div>
      </div>
      <div class="browser-content" id="browserContent"></div>
    </div>
  </div>
  <div class="container">
    <section id="intro" data-address="marie-laure.worldview.com" data-title="See the World Like Marie-Laure">
      <div class="section-marker" data-section="intro"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="sight" data-address="marie-laure.memories.com" data-title="The Last Pictures She Saw">
      <div class="section-marker" data-section="sight"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="blindness" data-address="marie-laure.darkness.com" data-title="Losing Her Sight">
      <div class="section-marker" data-section="blindness"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="adaptation" data-address="marie-laure.senses.com" data-title="Learning to Feel the World">
      <div class="section-marker" data-section="adaptation"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="drawingGame" data-address="marie-laure.touch.com" data-title="Draw Your Own Model">
      <div class="section-marker" data-section="drawingGame"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="game" data-address="marie-laure.experience.com" data-title="Remember the Pattern">
      <div class="section-marker" data-section="game"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="radio" data-address="marie-laure.broadcasts.com" data-title="Radio Broadcasts">
      <div class="section-marker" data-section="radio"></div>
      <div style="height: 70vh"></div>
    </section>
    <section id="ending" data-address="marie-laure.legacy.com" data-title="Marie-Laure's Legacy">
      <div class="section-marker" data-section="ending"></div>
      <div style="height: 70vh"></div>
    </section>
  </div>
  <div class="model-game" id="modelGame">
    <div class="game-instructions"></div>
    <div class="game-grid" id="gameGrid">
      <div class="game-cell" data-index="0"></div>
      <div class="game-cell" data-index="1"></div>
      <div class="game-cell" data-index="2"></div>
      <div class="game-cell" data-index="3"></div>
      <div class="game-cell" data-index="4"></div>
      <div class="game-cell" data-index="5"></div>
      <div class="game-cell" data-index="6"></div>
      <div class="game-cell" data-index="7"></div>
      <div class="game-cell" data-index="8"></div>
    </div>
    <div class="game-actions">
      <button id="checkPatternBtn" class="btn" style="display: none;">Check Pattern</button>
      <button id="closeGameBtn" class="btn btn-secondary">Close</button>
    </div>
  </div>
  <div class="model-score" id="modelScore">
    <h2>Your Drawing Score</h2>
    <div class="score-value">0%</div>
    <p>Submit your drawing to see your score!</p>
    <button id="closeScoreBtn" class="btn">Continue</button>
  </div>
  <div class="tooltip" id="tutorial"></div>
  <div id="papaBubble" class="papa-bubble">
      <span class="papa-label">Papa:</span>
      <span class="papa-message">Thinking... <span class="loading-dots"><span></span><span></span><span></span></span></span>
  </div>
  <button class="toggle-blindness-btn" id="toggleBlindnessBtn">Blindness On</button>
  <div id="idleOverlay" class="idle-overlay">
    <div>
      <h2>Welcome to the Interactive Experience</h2>
      <p>Scroll, click, or move your mouse to explore Marie-Laure's story.</p>
      <p>Use the navigation and tabs to discover different sections.</p>
      <p>When you're ready, simply interact with the page to begin.</p>
      <button id="closeIdleBtn" class="btn" style="margin-top:20px;">Start Exploring</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sectionData = {
        intro: {
          title: "See the World Like Marie-Laure",
          content: `
            <h2 class="subheading">All the Light We Cannot See</h2>
            <h1 class="heading">See the World Like Marie-Laure</h1>
            <p class="paragraph">Welcome to an interactive exploration of Marie-Laure's world, a journey through senses beyond sight. Scroll down to begin.</p>
            <blockquote class="quote">"Open your eyes and see what you can with them before they close forever." <br>― Anthony Doerr, All the Light We Cannot See</blockquote>
            <div class="tabs">
              <div class="tab active" data-tab="biography">Biography</div>
              <div class="tab" data-tab="paris">Paris</div>
              <div class="tab" data-tab="models">Papa's Models</div>
            </div>
            <div class="tab-content active" id="biography">
              <p class="paragraph">Marie-Laure LeBlanc loses her sight at age six. Her father, Daniel, head locksmith at Paris's Museum of Natural History, builds her a detailed miniature model of their neighborhood to help her navigate by touch.</p>
              <p class="paragraph">He nurtures her curiosity, reading Jules Verne, teaching Braille, and fostering her independence even as darkness descends upon her world and war looms over Europe.</p>
            </div>
            <div class="tab-content" id="paris">
              <p class="paragraph">Paris in the 1930s, a city of light and shadow, sound and scent. Marie-Laure's fading vision captures fleeting images before her father's intricate models become her map.</p>
              <p class="paragraph">Every curb, fountain, and bench is meticulously recreated, allowing her fingers to "see" the path her feet must learn to trust.</p>
            </div>
            <div class="tab-content" id="models">
              <p class="paragraph">Daniel LeBlanc's love is carved into wood. The miniature Paris, and later Saint-Malo, are masterpieces of tactile navigation.</p>
              <p class="paragraph">These models, complete with hidden compartments and tiny details, are more than just maps; they are testaments to a father's devotion and a lifeline for Marie-Laure's journey.</p>
              <div class="model-grid">
                <div class="model-item">
                  <img src="https://dnm.nflximg.net/api/v6/2DuQlx0fM4wd1nzqm5BFBi6ILa8/AAAAQUez8BMh95E1QeRI-lCGZ4vWaHLuBs63k5C-VPsjhs_NlPxGfSA_srp1NOaHKeowl-fAJuKDJGfNFh36AKWTGCM1SxwXknpRY8KEzJGtNIs11zsYhRt2MtuDpkTHC8uTrNa5MuLast61FKmBTR4BrwSH.jpg?r=d59" alt="Model of Saint-Malo">
                  <div class="model-title">Saint-Malo Model</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-building fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Paris Streets</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-house fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Their Home</div>
                </div>
                <div class="model-item">
                  <i class="fa-solid fa-key fa-3x" style="color: #8e8e93;"></i>
                  <div class="model-title">Hidden Compartment</div>
                </div>
              </div>
            </div>
          `
        },
        sight: {
          title: "The Last Pictures She Saw",
          content: `
            <h2 class="subheading">Fading Images</h2>
            <h1 class="heading">The Last Pictures She Saw</h1>
            <p class="paragraph">Before the world dissolved into shadows, Marie-Laure stored away memories of light: the vibrant snails at the museum, the glint of the Seine, her father's kind face.</p>
            <blockquote class="quote">"When I lost my sight, Werner, people said I was brave. When my father left, people said I was brave. But it is not bravery; I have no choice."</blockquote>
            <p class="paragraph">Flip the cards below to glimpse fragments of her visual past, echoes of the light before the dark.</p>
             <div class="memory-grid">
               <div class="memory-card">
                <div class="memory-card-front">
                  <i class="fa-solid fa-water"></i>
                </div>
                <div class="memory-card-back">
                  <i class="fa-solid fa-water fa-4x" style="color: #60a5fa;"></i>
                  <div class="memory-title">The River Seine</div>
                </div>
              </div>
               <div class="memory-card">
                <div class="memory-card-front">
                   <i class="fa-solid fa-person"></i>
                </div>
                <div class="memory-card-back">
                   <i class="fa-solid fa-person fa-4x" style="color: #8e8e93;"></i>
                   <div class="memory-title">Her Father, Daniel</div>
                </div>
               </div>
               <div class="memory-card">
                 <div class="memory-card-front">
                   <i class="fa-solid fa-book-open"></i>
                 </div>
                 <div class="memory-card-back">
                   <i class="fa-solid fa-book-open fa-4x" style="color: #a0522d;"></i>
                   <div class="memory-title">Jules Verne's Worlds</div>
                 </div>
               </div>
                <div class="memory-card">
                  <div class="memory-card-front">
                    <i class="fa-solid fa-key"></i>
                  </div>
                  <div class="memory-card-back">
                     <i class="fa-solid fa-key fa-4x" style="color: #f59e0b;"></i>
                    <div class="memory-title">Museum Keys & Locks</div>
                  </div>
                </div>
            </div>
          `
        },
        blindness: {
          title: "Losing Her Sight",
          content: `
            <h2 class="subheading">The Veil Descends</h2>
            <h1 class="heading">Losing Her Sight</h1>
            <p class="paragraph">At age six, congenital cataracts swiftly stole Marie-Laure's vision. The world didn't go black, but shifted into an overwhelming, formless brightness, then faded.</p>
            <blockquote class="quote">"It was like the entire world was caught in cataracts, a slow, relentless diffusion."</blockquote>
            <p class="paragraph">As you continue scrolling, the visual experience will dim, simulating the encroaching darkness and the shift to other senses. (Toggle button available)</p>
          `
        },
        adaptation: {
          title: "Learning to Feel the World",
          content: `
            <h2 class="subheading">Mapping by Touch</h2>
            <h1 class="heading">Learning to Feel the World</h1>
            <p class="paragraph">Blindness wasn't an end, but a transformation. Marie-Laure's fingers became her eyes, tracing the intricate wooden models her father crafted.</p>
            <p class="paragraph">She learned the geography of her world through texture, shape, and scale, memorizing routes block by block, step by careful step. Touch, sound, and smell became her guides.</p>
            <blockquote class="quote">"Walk the paths, count the steps, feel the textures beneath your feet. This is how you will know your way."</blockquote>
            <h3 style="font-size: 1.5rem; font-weight: 600; margin: 32px 0 16px;">The Saint-Malo Model</h3>
            <p class="paragraph">Forced to flee Paris, father and daughter arrive in the walled city of Saint-Malo. Daniel painstakingly recreates this new refuge in miniature, providing Marie-Laure with the key to navigate her confined world during the occupation.</p>
            <div class="city-model"></div>
          `
        },
        drawingGame: {
          title: "Draw Your Own Model",
          content: `
            <h2 class="subheading">Trace the Lines</h2>
            <h1 class="heading">Draw Your Own Model</h1>
            <p class="paragraph">Marie-Laure learned Saint-Malo through her fingertips on her father's model. Now, challenge your visual memory. Study the reference model, then try to recreate its essence on the canvas below.</p>
            <div style="text-align: center; margin-bottom: 24px;">
              <button id="showReferenceBtn" class="btn pulse-glow">View Reference Model</button>
              <button id="startDrawingBtn" class="btn" style="display: none;">Start Drawing</button>
            </div>
            <div id="referenceImage" style="display: none; margin-bottom: 24px; text-align: center;">
              <img src="https://dnm.nflximg.net/api/v6/2DuQlx0fM4wd1nzqm5BFBi6ILa8/AAAAQUez8BMh95E1QeRI-lCGZ4vWaHLuBs63k5C-VPsjhs_NlPxGfSA_srp1NOaHKeowl-fAJuKDJGfNFh36AKWTGCM1SxwXknpRY8KEzJGtNIs11zsYhRt2MtuDpkTHC8uTrNa5MuLast61FKmBTR4BrwSH.jpg?r=d59" alt="Saint-Malo Model" style="max-width: 100%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15);">
              <p style="margin-top: 12px; font-style: italic;">Memorize the key shapes and layout. It vanishes in 10 seconds!</p>
            </div>
            <div class="canvas-container" id="canvasContainer" style="display: none;">
              <canvas id="drawingCanvas" width="600" height="400"></canvas>
              <div class="drawing-tools">
                <div class="color-picker">
                  <div class="color-option active" style="background-color: #0a0a0f;" data-color="#0a0a0f"></div>
                  <div class="color-option" style="background-color: #4285F4;" data-color="#4285F4"></div>
                  <div class="color-option" style="background-color: #EA4335;" data-color="#EA4335"></div>
                  <div class="color-option" style="background-color: #FBBC05;" data-color="#FBBC05"></div>
                  <div class="color-option" style="background-color: #34A853;" data-color="#34A853"></div>
                </div>
                 <label for="brushSize" style="font-size: 12px; color: var(--subtle); margin: 0 5px;">Size:</label>
                <input type="range" min="1" max="20" value="3" class="brush-size" id="brushSize">
                <div class="drawing-actions">
                  <button id="clearCanvas" class="btn btn-secondary" title="Clear Canvas"><i class="fa-solid fa-trash"></i></button>
                  <button id="submitDrawing" class="btn">Submit Drawing</button>
                </div>
              </div>
            </div>
            <blockquote class="quote">"He continues tracing routes, speaking capitals and rivers aloud... her fingers mimic his on the small wooden blocks."</blockquote>
          `
        },
        game: {
          title: "Remember the Pattern",
          content: `
            <h2 class="subheading">Sensory Memory</h2>
            <h1 class="heading">Remember the Pattern</h1>
            <p class="paragraph">Marie-Laure relied on memory mapped through touch and sound. Test your own short-term visual memory. Observe the sequence of illuminated squares, then replicate the pattern.</p>
            <p class="paragraph">This exercise echoes how she learned routes and details without sight. Click below to begin the challenge.</p>
            <div style="text-align: center; margin-top: 20px;">
             <button id="startGameBtn" class="btn pulse-glow">Start Memory Challenge</button>
            </div>
            <blockquote class="quote">"Memory is curated. All this time I have been collecting memories, storing them, curating them."</blockquote>
          `
        },
        radio: {
          title: "Radio Broadcasts",
          content: `
            <h2 class="subheading">Voices in the Static</h2>
            <h1 class="heading">Radio Broadcasts</h1>
            <p class="paragraph">Sound became a vital connection to the world. In Saint-Malo, her great-uncle Etienne's hidden transmitter becomes both a comfort and a danger.</p>
            <p class="paragraph">The crackle of the radio brings music, forbidden news, coded messages for the Resistance, and the voice of 'the Professor' – broadcasts that intertwine her fate with Werner Pfennig's.</p>
            <div style="margin: 40px 0; padding: 24px; background: rgba(59, 130, 246, 0.08); border-radius: 12px; border-left: 4px solid var(--accent);" class="pulse-glow">
              <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; color: var(--accent);">
                <i class="fa-solid fa-radio" style="margin-right: 8px;"></i> Secret Transmissions
              </h3>
              <p style="font-style: italic; margin-bottom: 16px;" class="wiggle">"Five hundred forty-two steps from the bakery... read the numbers... seven... four..."</p>
              <p style="font-size: 0.875rem; color: var(--subtle);">From a tiny attic room, faint signals carried vital information across occupied France.</p>
            </div>
            <blockquote class="quote">"The brain is locked in total darkness, of course... it floats in a clear liquid inside the skull... But the world it constructs... it constructs a world based on streams of information."</blockquote>
          `
        },
        ending: {
          title: "Marie-Laure's Legacy",
          content: `
            <h2 class="subheading">The Light Within</h2>
            <h1 class="heading">Marie-Laure's Legacy</h1>
            <p class="paragraph">Marie-Laure's journey is a testament to resilience and the different ways we perceive the world. Sight may be lost, but understanding, connection, and courage illuminate the path forward.</p>
            <p class="paragraph">She survives the war, pursues her passion for science inspired by the museum of her childhood, and becomes a mollusk specialist, forever connected to the natural world she learned through books and touch.</p>
            <blockquote class="quote">"So how, children, does the brain, which lives without a spark of light, build for us a world full of light?"</blockquote>
            <div style="margin-top: 40px; text-align: center;">
              <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 24px;">Thank You for Exploring</h3>
              <p class="paragraph" style="text-align: center;">This interactive experience aimed to offer a glimpse into the sensory world of "All the Light We Cannot See".</p>
               <p class="paragraph" style="text-align: center; font-size: 0.9rem; color: var(--subtle);">Concept by Mirko. Remember to read the book!</p>
            </div>
          `
        }
      };
      const GEMINI_API_KEY = "AIzaSyAtIJNuqJsnifU3Ez3CNEtjUrhQWbB1N7o";
      const GEMINI_MODEL_NAME = "gemini-2.0-flash-lite";
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`;
      const progressBar = document.getElementById('progressBar');
      const blindnessOverlay = document.getElementById('blindnessOverlay');
      const browserAddress = document.getElementById('browserAddress');
      const browserContent = document.getElementById('browserContent');
      const stickyBrowser = document.getElementById('stickyBrowser');
      const sections = document.querySelectorAll('section');
      const sectionMarkers = document.querySelectorAll('.section-marker');
      const tutorial = document.getElementById('tutorial');
      const papaBubble = document.getElementById('papaBubble');
      const papaMessageSpan = papaBubble.querySelector('.papa-message');
      const toggleBlindnessBtn = document.getElementById('toggleBlindnessBtn');
      let lastScrollTop = 0;
      let ticking = false;
      let currentSection = 'intro';
      let activeSections = ['intro'];
      let isFirstVisit = true;
      let lastMouseX = window.innerWidth / 2;
      let lastMouseY = window.innerHeight / 2;
      let spotlightActive = false;
      let papaTimeout;
      let blindnessEnabled = true;
      let idleTimeout;
      const idleOverlay = document.getElementById('idleOverlay');
      const closeIdleBtn = document.getElementById('closeIdleBtn');
      function updateBrowserContent(sectionId) {
        const section = sectionData[sectionId];
        if (!section) return;
        const contentWrapper = document.createElement('div');
        contentWrapper.className = 'browser-content-transition';
        contentWrapper.innerHTML = section.content;
        while (browserContent.firstChild) {
          browserContent.removeChild(browserContent.firstChild);
        }
        browserContent.appendChild(contentWrapper);
        browserContent.scrollTop = 0;
        setTimeout(() => {
          activateElements(browserContent);
          attachEventListeners();
        }, 50);
      }
      function animateAddressChange(newAddress) {
         if (browserAddress.textContent === newAddress) return;
         browserAddress.style.opacity = '0';
         browserAddress.style.transform = 'translateY(-5px)';
         setTimeout(() => {
             browserAddress.textContent = newAddress;
             browserAddress.style.opacity = '1';
             browserAddress.style.transform = 'translateY(0)';
             browserAddress.classList.add('wiggle');
             setTimeout(() => { browserAddress.classList.remove('wiggle'); }, 800);
         }, 300);
      }
      function activateElements(container) {
        const elements = container.querySelectorAll('.heading, .subheading, .paragraph, .quote, .tabs');
        elements.forEach((el, index) => {
            setTimeout(() => el.classList.add('active'), index * 50);
        });
      }
      function attachEventListeners() {
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', function() {
            const parentTabs = this.closest('.tabs');
            if (!parentTabs) return;
            parentTabs.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            let contentParent = parentTabs.parentNode;
            let targetContent = contentParent.querySelector(`.tab-content#${tabId}`);
            contentParent.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            if (targetContent) {
                targetContent.classList.add('active');
            }
          });
        });
        document.querySelectorAll('.memory-card').forEach(card => {
          card.addEventListener('click', function() { this.classList.toggle('flipped'); });
        });
        const showReferenceBtn = document.getElementById('showReferenceBtn');
        if (showReferenceBtn) setupDrawingGame();
        const startGameBtn = document.getElementById('startGameBtn');
        if (startGameBtn) {
             startGameBtn.onclick = () => {
                 document.getElementById('modelGame').classList.add('active');
                 startMemoryGame();
             };
        }
        const closeGameBtn = document.getElementById('closeGameBtn');
        if (closeGameBtn) {
            closeGameBtn.onclick = () => {
                 document.getElementById('modelGame').classList.remove('active');
            };
        }
        const closeScoreBtn = document.getElementById('closeScoreBtn');
        if (closeScoreBtn) {
             closeScoreBtn.onclick = () => {
                 document.getElementById('modelScore').classList.remove('active');
             };
        }
      }
      function setupDrawingGame() {
        const showReferenceBtn = document.getElementById('showReferenceBtn');
        const startDrawingBtn = document.getElementById('startDrawingBtn');
        const referenceImageDiv = document.getElementById('referenceImage');
        const canvasContainer = document.getElementById('canvasContainer');
        const canvas = document.getElementById('drawingCanvas');
        if (!canvas || !showReferenceBtn || !startDrawingBtn || !referenceImageDiv || !canvasContainer) {
             return;
        }
        const ctx = canvas.getContext('2d');
        const clearCanvasBtn = document.getElementById('clearCanvas');
        const submitDrawingBtn = document.getElementById('submitDrawing');
        const colorOptions = document.querySelectorAll('.color-option');
        const brushSizeSlider = document.getElementById('brushSize');
        const modelScoreModal = document.getElementById('modelScore');
        const scoreValueEl = modelScoreModal.querySelector('.score-value');
        const scoreMessageEl = modelScoreModal.querySelector('p');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = '#0a0a0f';
        let currentBrushSize = brushSizeSlider.value;
        let referenceTimeout;
        function startDrawingStroke(e) {
          isDrawing = true;
          const { x, y } = getCoordinates(e);
          [lastX, lastY] = [x, y];
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
        }
        function drawStroke(e) {
          if (!isDrawing) return;
          e.preventDefault();
          const { x, y } = getCoordinates(e);
          ctx.lineTo(x, y);
          ctx.stroke();
          [lastX, lastY] = [x, y];
        }
        function endDrawingStroke() {
            if (!isDrawing) return;
            ctx.closePath();
            isDrawing = false;
        }
        function getCoordinates(e) {
          const rect = canvas.getBoundingClientRect();
          let x, y;
          if (e.type.startsWith('touch')) {
            x = e.touches[0].clientX - rect.left;
            y = e.touches[0].clientY - rect.top;
          } else {
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
          }
           x = Math.max(0, Math.min(canvas.width, x));
           y = Math.max(0, Math.min(canvas.height, y));
          return { x, y };
        }
        function resizeCanvas() {
          const containerWidth = canvasContainer.offsetWidth;
          canvas.width = containerWidth;
          canvas.height = 400;
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = currentBrushSize;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
        }
        showReferenceBtn.onclick = () => {
            clearTimeout(referenceTimeout);
            referenceImageDiv.style.display = 'block';
            showReferenceBtn.style.display = 'none';
            startDrawingBtn.style.display = 'inline-block';
            canvasContainer.style.display = 'none';
            showTutorial('Memorize this! It disappears in 10 seconds.', referenceImageDiv.querySelector('img'), 'top', 4000);
            referenceTimeout = setTimeout(() => {
                if (referenceImageDiv.style.display === 'block') {
                   startDrawingBtn.click();
                }
            }, 10000);
        };
        startDrawingBtn.onclick = () => {
            clearTimeout(referenceTimeout);
            referenceImageDiv.style.display = 'none';
            startDrawingBtn.style.display = 'none';
            canvasContainer.style.display = 'block';
            resizeCanvas();
            showTutorial('Draw the model from memory.', canvas, 'top', 4000);
        };
        colorOptions.forEach(option => {
          option.onclick = function() {
            colorOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            currentColor = this.getAttribute('data-color');
            ctx.strokeStyle = currentColor;
          };
        });
        brushSizeSlider.oninput = function() {
          currentBrushSize = this.value;
          ctx.lineWidth = currentBrushSize;
        };
        clearCanvasBtn.onclick = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        };
        submitDrawingBtn.onclick = () => {
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          let nonEmptyPixels = 0;
          for (let i = 0; i < data.length; i += 4) {
            if (data[i + 3] > 10) { nonEmptyPixels++; }
          }
          const totalPixels = canvas.width * canvas.height;
          const fillRatio = nonEmptyPixels / totalPixels;
          let score = 0;
          if (fillRatio > 0.01 && fillRatio <= 0.05) score = 50 + Math.round(Math.random() * 10);
          else if (fillRatio > 0.05 && fillRatio <= 0.15) score = 65 + Math.round(Math.random() * 15);
          else if (fillRatio > 0.15) score = 80 + Math.round(Math.random() * 15);
          else score = 20 + Math.round(Math.random() * 10);
          score = Math.min(99, Math.max(0, score));
          scoreValueEl.textContent = score + '%';
          let message;
          if (score >= 90) message = "Excellent! A true representation.";
          else if (score >= 75) message = "Great work! You have a keen eye for detail.";
          else if (score >= 55) message = "Good effort! Captures the essence.";
          else message = "A start! Keep practicing observation.";
          scoreMessageEl.textContent = message;
          modelScoreModal.classList.add('active');
        };
        window.addEventListener('resize', resizeCanvas);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentBrushSize;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        canvas.addEventListener('touchstart', startDrawingStroke, { passive: false });
        canvas.addEventListener('touchmove', drawStroke, { passive: false });
        canvas.addEventListener('touchend', endDrawingStroke);
        canvas.addEventListener('touchcancel', endDrawingStroke);
        canvas.addEventListener('mousedown', startDrawingStroke);
        canvas.addEventListener('mousemove', drawStroke);
        canvas.addEventListener('mouseup', endDrawingStroke);
        canvas.addEventListener('mouseout', endDrawingStroke);
      }
      function startMemoryGame() {
        const modelGame = document.getElementById('modelGame');
        const gameInstructions = modelGame.querySelector('.game-instructions');
        const checkPatternBtn = document.getElementById('checkPatternBtn');
        const gameCells = modelGame.querySelectorAll('.game-cell');
        const grid = document.getElementById('gameGrid');
        let pattern = [];
        let userPattern = [];
        let gameState = 'inactive';
        let gameLevel = 1;
        let correctAnswers = 0;
        let showingTimeout;
        let feedbackTimeout;
        function cleanupTimeouts() { clearTimeout(showingTimeout); clearTimeout(feedbackTimeout); }
        function resetGameGrid() {
            cleanupTimeouts();
            gameCells.forEach(cell => {
                cell.classList.remove('selected', 'correct-pattern');
                cell.style.backgroundColor = '';
                cell.style.animation = '';
                cell.style.opacity = '1';
            });
            userPattern = [];
            checkPatternBtn.style.display = 'none';
         }
        function comparePatterns(p1, p2) {
             if (p1.length !== p2.length) return false;
             const s1 = [...p1].sort((a, b) => a - b);
             const s2 = [...p2].sort((a, b) => a - b);
             return s1.every((v, i) => v === s2[i]);
         }
        function generateRandomPattern(level) {
             const len = Math.min(3 + Math.floor(level / 2), 7);
             const p = [];
             while (p.length < len) {
                 const idx = Math.floor(Math.random() * 9);
                 if (!p.includes(idx)) p.push(idx);
             }
             return p;
        }
        function showPattern() {
            resetGameGrid();
            gameState = 'showing';
            gameInstructions.style.opacity = 0;
            setTimeout(() => {
                 gameInstructions.innerHTML = `
                    <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Watch Closely</h2>
                    <p>Memorize the pattern...</p>
                    <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Score: ${correctAnswers}</p>
                `;
                 gameInstructions.style.opacity = 1;
            }, 300);
            pattern = generateRandomPattern(gameLevel);
            let delay = 1500;
            pattern.forEach((index, i) => {
                showingTimeout = setTimeout(() => { if(gameState === 'showing') gameCells[index].classList.add('selected'); }, delay + i * 700);
                showingTimeout = setTimeout(() => { if(gameState === 'showing') gameCells[index].classList.remove('selected'); }, delay + (i * 700) + 600);
            });
            showingTimeout = setTimeout(() => {
                if (gameState !== 'showing') return;
                gameState = 'selecting';
                checkPatternBtn.style.display = 'inline-block';
                gameInstructions.style.opacity = 0;
                 setTimeout(() => {
                     gameInstructions.innerHTML = `
                        <h2 style="margin-bottom: 16px; font-size: 1.75rem;">Level ${gameLevel}: Your Turn</h2>
                        <p>Recreate the pattern you just saw.</p>
                        <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Score: ${correctAnswers}</p>
                    `;
                     gameInstructions.style.opacity = 1;
                 }, 300);
            }, delay + (pattern.length * 700) + 700);
        }
        function handleCellClick(event) {
            if (gameState !== 'selecting' || !event.target.classList.contains('game-cell')) return;
            const cell = event.target;
            const index = parseInt(cell.getAttribute('data-index'));
            cell.classList.toggle('selected');
            if (cell.classList.contains('selected')) {
                if (!userPattern.includes(index)) userPattern.push(index);
            } else {
                userPattern = userPattern.filter(i => i !== index);
            }
        }
        function checkUserPattern() {
            if (gameState !== 'selecting') return;
            gameState = 'checking';
            checkPatternBtn.style.display = 'none';
            gameState = 'feedback';
            gameInstructions.style.opacity = 0;
            const correct = comparePatterns(pattern, userPattern);
            if (correct) {
                correctAnswers++;
                gameLevel++;
                 setTimeout(() => {
                     gameInstructions.innerHTML = `
                        <h2 style="margin-bottom: 16px; font-size: 1.75rem; color: var(--success);">Correct!</h2>
                        <p>Excellent memory! Ready for level ${gameLevel}?</p>
                        <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Score: ${correctAnswers}</p>
                    `;
                     gameInstructions.style.opacity = 1;
                 }, 300);
                gameCells.forEach(cell => {
                     if (userPattern.includes(parseInt(cell.getAttribute('data-index')))) {
                          cell.style.animation = 'pulse-glow 0.4s 2 alternate';
                          setTimeout(() => { cell.style.animation = ''; }, 800);
                     }
                });
                feedbackTimeout = setTimeout(showPattern, 2500);
            } else {
                 setTimeout(() => {
                     gameInstructions.innerHTML = `
                        <h2 style="margin-bottom: 16px; font-size: 1.75rem; color: var(--danger);">Incorrect</h2>
                        <p>That wasn't it. Let's review the correct pattern.</p>
                        <p style="margin-top: 8px; font-size: 0.875rem; color: rgba(255,255,255,0.7);">Score: ${correctAnswers}</p>
                    `;
                     gameInstructions.style.opacity = 1;
                 }, 300);
                 gameCells.forEach(cell => cell.classList.remove('selected'));
                 pattern.forEach(index => {
                     gameCells[index].classList.add('correct-pattern');
                 });
                 feedbackTimeout = setTimeout(showPattern, 3500);
            }
        }
        const newGrid = grid.cloneNode(true);
         grid.parentNode.replaceChild(newGrid, grid);
         newGrid.addEventListener('click', handleCellClick);
        checkPatternBtn.onclick = checkUserPattern;
        document.getElementById('closeGameBtn').onclick = () => {
             cleanupTimeouts();
             document.getElementById('modelGame').classList.remove('active');
        };
        showPattern();
      }
      function showTutorial(message, targetElement, position = 'top', duration = 4000) {
        if (!targetElement && !message) return;
        tutorial.textContent = message;
        tutorial.style.visibility = 'hidden';
        tutorial.style.display = 'block';
        const tooltipRect = tutorial.getBoundingClientRect();
        tutorial.style.display = '';
        tutorial.style.visibility = '';
        let top = 0, left = 0;
        const margin = 10;
        const edgeMargin = 10;
        if (targetElement) {
             const targetRect = targetElement.getBoundingClientRect();
            switch (position) {
                case 'top': top = targetRect.top - tooltipRect.height - margin; left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2); break;
                case 'bottom': top = targetRect.bottom + margin; left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2); break;
                case 'left': top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2); left = targetRect.left - tooltipRect.width - margin; break;
                case 'right': top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2); left = targetRect.right + margin; break;
                case 'center': top = window.innerHeight / 2 - tooltipRect.height / 2; left = window.innerWidth / 2 - tooltipRect.width / 2; break;
                default: top = targetRect.top - tooltipRect.height - margin; left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
            }
        } else {
             top = window.innerHeight / 2 - tooltipRect.height / 2;
             left = window.innerWidth / 2 - tooltipRect.width / 2;
        }
        left = Math.max(edgeMargin, Math.min(left, window.innerWidth - tooltipRect.width - edgeMargin));
        top = Math.max(edgeMargin, Math.min(top, window.innerHeight - tooltipRect.height - edgeMargin));
        tutorial.style.top = `${top}px`;
        tutorial.style.left = `${left}px`;
        tutorial.style.transform = '';
        tutorial.classList.add('active');
        setTimeout(hideTutorial, duration);
      }
      function hideTutorial() { tutorial.classList.remove('active'); }
      function toggleBlindnessEffect() {
        blindnessEnabled = !blindnessEnabled;
        if (!blindnessEnabled) {
          if (spotlightActive) { document.removeEventListener('mousemove', spotlightHandler); spotlightActive = false; }
          blindnessOverlay.style.transition = 'background 0.5s ease-out';
          blindnessOverlay.style.background = 'rgba(0,0,0,0)';
          toggleBlindnessBtn.classList.add('disabled');
          toggleBlindnessBtn.textContent = 'Blindness Off';
           if(document.body.classList.contains('dark') && currentSection !== 'blindness' && currentSection !== 'adaptation') {
                document.body.classList.remove('dark');
           }
        } else {
          toggleBlindnessBtn.classList.remove('disabled');
          toggleBlindnessBtn.textContent = 'Blindness On';
          handleScroll();
        }
      }
      function updateSpotlight(x, y, intensity) {
            blindnessOverlay.style.background = `radial-gradient(circle at ${x}px ${y}px, transparent 55px, rgba(0,0,0,${intensity.toFixed(2)}) 85px)`;
      }
      function spotlightHandler(e) {
        if (!blindnessEnabled || !spotlightActive) return;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
        const currentBg = blindnessOverlay.style.background;
        const currentIntensityMatch = currentBg.match(/rgba\(0,0,0,([\d.]+)\)/);
        const currentIntensity = currentIntensityMatch ? parseFloat(currentIntensityMatch[1]) : 0.9;
        updateSpotlight(e.clientX, e.clientY, currentIntensity);
      }
      function determineCurrentSection() {
        let newCurrentSection = currentSection;
        let minDistance = Infinity;
        const viewportCenter = window.innerHeight / 2;
        sectionMarkers.forEach(marker => {
          const rect = marker.getBoundingClientRect();
          const distance = Math.abs(rect.top - viewportCenter);
          if (rect.top < window.innerHeight && rect.bottom > 0) {
            if (distance < minDistance) {
              minDistance = distance;
              newCurrentSection = marker.getAttribute('data-section');
            }
          }
        });
        if (newCurrentSection !== currentSection) {
          currentSection = newCurrentSection;
          updateBrowserContent(currentSection);
          updatePapaBubble();
          const sectionElement = document.querySelector(`section[id="${currentSection}"]`);
          if (sectionElement) {
             const newAddress = sectionElement.getAttribute('data-address');
             animateAddressChange(newAddress);
          }
          if (!activeSections.includes(currentSection)) {
            activeSections.push(currentSection);
            if (currentSection === 'drawingGame') {
                showTutorial('Click "View Reference Model" to start drawing', document.getElementById('showReferenceBtn'), 'top', 5000);
            } else if (currentSection === 'game') {
                showTutorial('Click to test your memory like Marie-Laure', document.getElementById('startGameBtn'), 'top', 5000);
            } else if (currentSection === 'blindness') {
                showTutorial('The screen will dim as you scroll further...', document.body, 'center', 4000);
            }
          }
        }
      }
      function handleScroll() {
        const scrollTop = window.scrollY;
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const height = scrollHeight - clientHeight;
        const scrollProgress = height > 0 ? (scrollTop / height) * 100 : 0;
        progressBar.style.width = scrollProgress + "%";
        const parallaxOffset = Math.min(Math.max((scrollProgress / 100) * 30 - 15, -15), 15);
        const scaleFactor = 1 - Math.abs(parallaxOffset) / 150;
        stickyBrowser.style.transform = `translate(-50%, calc(-50% + ${parallaxOffset}px)) scale(${scaleFactor})`;
        const blindnessStart = 30;
        const blindnessEnd = 55;
        const darknessThreshold = 40;
        if (blindnessEnabled && scrollProgress > blindnessStart && scrollProgress < blindnessEnd) {
            const midPoint = (blindnessStart + blindnessEnd) / 2;
            const progressInEffect = (scrollProgress - blindnessStart) / (blindnessEnd - blindnessStart);
            const intensityFactor = 1 - Math.abs(progressInEffect - 0.5) * 2;
            const blindnessIntensity = Math.min(intensityFactor * 0.99, 0.99);
            if (!spotlightActive) {
                 document.addEventListener('mousemove', spotlightHandler);
                 spotlightActive = true;
                 blindnessOverlay.style.transition = 'background 0.3s ease-out';
             }
            updateSpotlight(lastMouseX, lastMouseY, blindnessIntensity);
            if (scrollProgress > darknessThreshold) {
                 document.body.classList.add('dark');
            } else {
                 document.body.classList.remove('dark');
            }
        } else {
             if (spotlightActive) {
                 document.removeEventListener('mousemove', spotlightHandler);
                 spotlightActive = false;
                 blindnessOverlay.style.transition = 'background 0.5s ease-out';
                 blindnessOverlay.style.background = 'rgba(0, 0, 0, 0)';
             }
             if (currentSection !== 'blindness' && currentSection !== 'adaptation') {
                 document.body.classList.remove('dark');
             }
        }
        determineCurrentSection();
        lastScrollTop = scrollTop;
      }
      function updatePapaBubble() {
            clearTimeout(papaTimeout);
            papaBubble.classList.remove('visible');
            if (!sectionData[currentSection]) {
                showPapaFallback("Just keep exploring, little one.");
                return;
            }
            const prompt = `You are Papa from 'All the Light We Cannot See'. The user is exploring an interactive experience about Marie-Laure. They are currently viewing the section titled "${sectionData[currentSection].title}" (internal ID: ${currentSection}). Offer a short (1-2 sentences max), comforting, encouraging, or contextually relevant piece of advice or observation in Papa's voice, related to this section's theme. Be gentle, slightly melancholic but hopeful, and supportive. Examples: 'Remember the feel of the model, Marie-Laure.', 'Even in darkness, listen closely.', 'Ah, the sea air...'. Do not include quotation marks in your response, and make it summarized and a short phrase`;
            const requestBody = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    maxOutputTokens: 60,
                    stopSequences: ["\n\n"]
                }
            };
             papaMessageSpan.innerHTML = `Thinking... <span class="loading-dots"><span></span><span></span><span></span></span>`;
             papaBubble.classList.add('visible');
             papaTimeout = setTimeout(() => {
                 fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(requestBody)
                 })
                 .then(response => {
                    if (!response.ok) {
                         return response.json().catch(() => {
                             throw new Error(`API Error ${response.status}: ${response.statusText}`);
                         }).then(err => {
                            throw new Error(`API Error ${response.status}: ${err.error?.message || response.statusText}`);
                         });
                    }
                    return response.json();
                 })
                 .then(data => {
                     let reply = "Stay strong, my little locksmith.";
                     if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                         reply = data.candidates[0].content.parts[0].text.trim();
                     } else if (data?.promptFeedback?.blockReason) {
                         reply = "Sometimes words are hard to find, but I am near.";
                     }
                      showPapaMessage(reply);
                 })
                 .catch(error => {
                     showPapaFallback(`The radio signal is weak today... Remember what I taught you.`);
                 });
            }, 500);
      }
        function showPapaMessage(message) {
           papaBubble.classList.remove('visible');
           setTimeout(() => {
                papaMessageSpan.textContent = message;
                papaBubble.classList.add('visible');
           }, 150);
        }
        function showPapaFallback(fallbackMessage) {
            papaBubble.classList.remove('visible');
            setTimeout(() => {
                const responses = papaResponses[currentSection] || papaResponses.default;
                const randomIndex = Math.floor(Math.random() * responses.length);
                papaMessageSpan.textContent = fallbackMessage || responses[randomIndex];
                papaBubble.classList.add('visible');
            }, 150);
        }
        const papaResponses = {
            intro: [ "Welcome. Remember, Marie-Laure, the world holds wonders beyond sight.", "Take your time exploring, little one. Each step is a discovery.", "Let your fingers trace the path, just like the models." ],
            sight: [ "Hold onto the bright memories, Marie-Laure. They are yours forever.", "Even as light fades, the images stay within you.", "These memories... part of your unique story." ],
            blindness: [ "It's alright to feel the darkness, little locksmith. But don't let it extinguish your spirit.", "Courage is feeling fear, but taking the next step anyway.", "Your other senses sharpen now. Trust them, they are your guides." ],
            adaptation: [ "See? Your fingers learn the way. Each turn, each texture.", "The models are your map, Marie-Laure. Know them well.", "This new place... we will learn it together, step by careful step." ],
            drawingGame: [ "Like tracing the wooden streets, yes? Feel the shape in your mind.", "Concentrate, little one. Remember the important lines.", "Practice makes the fingers remember." ],
            game: [ "Ah, a memory challenge! Your mind is strong, Marie-Laure. Focus.", "Like remembering the steps to the bakery? You know how.", "Attend to the sequence. Patience." ],
            radio: [ "The radio... marvels and dangers travel on its waves. Be vigilant.", "Voices across the air... they remind us we are connected.", "Listen closely. Sometimes truth hides in the static." ],
            ending: [ "You see, Marie-Laure? You found the light within yourself.", "The world is vast, keep learning, keep sensing.", "I am proud of the scientist you've become. Always curious." ],
            default: [ "Stay curious, my little one.", "I am always near, Marie-Laure.", "Keep moving forward. One step, then the next." ]
      };
      function handleScrollThrottled() {
         if (!ticking) {
          window.requestAnimationFrame(function() {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      }
      window.addEventListener('scroll', handleScrollThrottled);
      toggleBlindnessBtn.addEventListener('click', toggleBlindnessEffect);
      function resetIdleTimer() {
        clearTimeout(idleTimeout);
        hideIdleOverlay();
        idleTimeout = setTimeout(showIdleOverlay, 15000);
      }
      function showIdleOverlay() {
        idleOverlay.classList.add('visible');
      }
      function hideIdleOverlay() {
        idleOverlay.classList.remove('visible');
      }
      ["mousemove", "click", "keypress", "touchstart"].forEach(event => {
        window.addEventListener(event, resetIdleTimer, true);
      });
      closeIdleBtn.addEventListener('click', function() {
        hideIdleOverlay();
        resetIdleTimer();
      });
      updateBrowserContent('intro');
      updatePapaBubble();
      if (isFirstVisit) {
        showTutorial('Scroll down to explore Marie-Laure\'s story', document.body, 'bottom', 5000);
        isFirstVisit = false;
      }
      handleScroll();
    });
  </script>
</body>
</html>
